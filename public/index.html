<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://replit.com https://*.replit.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; img-src 'self' data: blob: https://images.unsplash.com https://*.unsplash.com; font-src 'self' data: https://fonts.gstatic.com https://cdn.jsdelivr.net; connect-src 'self' https://cdn.jsdelivr.net https://replit.com https://*.replit.com; object-src 'none'; base-uri 'self'; form-action 'self'; frame-src 'self' https://*.replit.dev https://replit.com; report-uri /csp-report;">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Force browser refresh: 2025-09-30-v2 -->
    <title>TomoTrip - åœ°å…ƒã‚¬ã‚¤ãƒ‰ã¨ç‰¹åˆ¥ãªæ—…ã‚’ç™ºè¦‹</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- CSP compatibility fixes -->
    <script src="env/csp-fix.js"></script>
    <!-- Environment configuration - must be first -->
    <script type="module" src="env/app-config.mjs"></script>
    
    <!-- Build ID and cache cleanup for consistency - CSP compliant -->
    <script src="env/build-id.js"></script>
    <script src="sw-unregister.js"></script>
    
    <!-- Complete error suppression system - TEMPORARILY DISABLED FOR DEBUGGING -->
    <script src="env/csp-fix.js"></script>
    <script src="webgl-fix.js" defer></script>
    <!-- <script src="error_suppressor.js" defer></script> TEMPORARILY DISABLED FOR DEBUGGING -->
    
    <!-- Debug fixes applied - JavaScript execution restored -->
    
    <!-- DEBUG: Test if basic JavaScript works -->
    <script>
        console.log('ğŸ”¥ BOOTSTRAP: Basic JavaScript working! Cache busted: 20250923-1246');
        window.onerror = function(msg, url, line, col, error) {
            console.error('ğŸš¨ JS ERROR:', msg, 'at', url + ':' + line + ':' + col);
            return false; // Don't suppress default error handling
        };
        window.addEventListener('unhandledrejection', function(event) {
            console.error('ğŸš¨ UNHANDLED PROMISE REJECTION:', event.reason);
        });
        
        // Force cache refresh for modules
        if (performance.navigation.type === performance.navigation.TYPE_RELOAD) {
            console.log('ğŸ”„ Hard refresh detected - clearing module cache');
        }
        
        // Module loading check - no emergency overrides needed
        console.log('âœ… Main app modules will load properly');
    </script>
    
    <!-- Management Center Functions -->
    <script src="management.js" defer></script>
    
    
    <!-- Main application initialization - NEW FILE NAME TO BYPASS CACHE -->
    <script type="module" src="assets/js/app-init.mjs?cachebust=20251119-entry-v3" defer></script>
    
    
    
    <!-- CSS Load Order: Bootstrap CSS â†’ Local Icons â†’ Custom CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <link rel="stylesheet" href="ocean_background.css">
    <link rel="stylesheet" href="assets/css/footer.css">
    <link rel="stylesheet" href="assets/css/auth-modal.css">
    <link rel="stylesheet" href="assets/css/bugfixes.css?v=cache-bust-20250923-1245">
    <!-- âœ… CODEX-OPTIMIZED: Guide Card UI/UX + Smartphone Optimization -->
    <link rel="stylesheet" href="assets/css/guide-cards.css?v=20251123-codex">

    <style>
        /* Cache bust: 2025-09-30-v5-layout-alignment */
        .guide-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* Chat message styling */
        .max-width-70 {
            max-width: 70%;
        }
        
        #chatMessages {
            min-height: 300px;
        }
        
        #chatMessages::-webkit-scrollbar {
            width: 6px;
        }
        
        #chatMessages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'BIZ UDPGothic', 'Meiryo', sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            display: flex !important;
            align-items: center !important;
            gap: 15px !important;
            font-weight: bold;
            color: #333 !important;
            text-decoration: none;
        }
        
        .brand-text {
            display: flex !important;
            flex-direction: column !important;
            gap: 3px !important;
            justify-content: center !important;
        }
        
        .brand-name {
            display: none !important;
        }
        
        .brand-tagline {
            font-size: 1.2rem !important;
            font-weight: 700 !important;
            color: #333 !important;
            letter-spacing: 0.5px !important;
            white-space: nowrap !important;
            line-height: 1.3 !important;
        }
        
        .brand-subtitle {
            font-size: 0.85rem !important;
            font-weight: 400 !important;
            color: #666 !important;
            letter-spacing: 0.3px !important;
            white-space: nowrap !important;
            line-height: 1.3 !important;
        }
        
        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼å…¨ä½“ã‚’ä¸­å¤®å¯„ã› */
        .navbar .container,
        .navbar .container-fluid {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 40px !important;
        }
        
        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ */
        @media (min-width: 769px) and (max-width: 1200px) {
            .brand-tagline {
                font-size: 1rem !important;
            }
            
            .brand-subtitle {
                font-size: 0.75rem !important;
            }
            
            .navbar .container,
            .navbar .container-fluid {
                gap: 25px !important;
            }
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã‚’éè¡¨ç¤º */
        @media (max-width: 768px) {
            .brand-subtitle {
                display: none !important;
            }
            
            .brand-tagline {
                font-size: 0.8rem !important;
                white-space: normal !important;
                max-width: 160px !important;
            }
            
            .navbar-brand {
                gap: 10px !important;
            }
            
            .navbar .container,
            .navbar .container-fluid {
                gap: 10px !important;
            }
        }
        
        /* å°ã•ã„ãƒ¢ãƒã‚¤ãƒ«ï¼šã‚¿ã‚°ãƒ©ã‚¤ãƒ³ã‚‚éè¡¨ç¤º */
        @media (max-width: 576px) {
            .brand-tagline {
                display: none !important;
            }
            
            .brand-text {
                display: none !important;
            }
        }

        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: white;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        
        .logo-container img {
            width: 52px;
            height: 52px;
            object-fit: contain;
            border-radius: 50%;
            background: white;
            display: block;
        }

        /* Hero Section - Bright Ocean Yacht Background */
        .hero-section {
            position: relative !important;
            height: 100vh !important;
            min-height: 100vh !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            overflow: hidden !important;
        }
        
        /* Background image layer with bright filters */
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('/assets/images/beach-yacht-tourists.jpg');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: scroll;
            /* Moderately bright, natural filters for ocean yacht scene */
            filter: brightness(1.2) contrast(1.05) saturate(1.1);
            z-index: -2;
        }
        
        /* Mobile background fix for English version */
        @media (max-width: 768px) {
            body, html {
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat scroll !important;
                min-height: 100vh !important;
                width: 100% !important;
            }
            
            .hero-section::before {
                background-attachment: scroll;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: -10;
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat !important;
            }
        }
        
        /* Extra narrow mobile screens */
        @media (max-width: 480px) {
            body, html, .hero-section {
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat scroll !important;
                min-height: 100vh !important;
                width: 100vw !important;
            }
        }
        
        /* Light overlay for text readability */
        .hero-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: -1;
        }
        
        /* Ensure content is visible */
        .hero-section .container,
        .hero-section .row,
        .hero-section .col-12,
        .hero-section .text-center {
            position: relative !important;
            z-index: 20 !important;
        }

        /* Language Switcher - Center Position */
        .language-switcher-center {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 0;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border-radius: 25px;
            overflow: hidden;
            background: transparent;
        }

        .lang-btn-jp, .lang-btn-en {
            padding: 15px 30px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            color: white;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        @media (max-width: 768px) {
            .language-switcher-center {
                top: 20%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 320px;
            }
            
            .lang-btn-jp, .lang-btn-en {
                padding: 12px 20px;
                font-size: 14px;
                min-width: 100px;
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .language-switcher-center {
                top: 18%;
                width: 95%;
                max-width: 280px;
            }
            
            .lang-btn-jp, .lang-btn-en {
                padding: 10px 15px;
                font-size: 13px;
                min-width: 80px;
            }
        }

        .lang-btn-jp {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        .lang-btn-en {
            background: linear-gradient(135deg, #4287f5, #64a8ff);
        }

        .lang-btn-jp:hover {
            background: linear-gradient(135deg, #ff5252, #ff7979);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }

        .lang-btn-en:hover {
            background: linear-gradient(135deg, #3367d6, #5a9cff);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66,135,245,0.4);
        }

        /* Hero Content */
        .hero-content {
            text-align: center;
            color: white;
            z-index: 50;
            max-width: 800px;
            padding: 0 20px;
            margin-top: 150px;
        }

        .hero-title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1.5rem;
        }

        .hero-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            padding: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-logo img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            border-radius: 50%;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-hero {
            padding: 15px 35px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 35px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .btn-primary-hero {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary-hero:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,123,255,0.4);
        }

        .btn-outline-hero {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline-hero:hover {
            background: white;
            color: #333;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,255,255,0.3);
        }

        /* Guide Cards */
        .guide-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            height: 100%;
        }

        .guide-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .guide-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .guide-card-body {
            padding: 1.5rem;
        }

        .guide-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .guide-location {
            color: #6c757d;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guide-languages {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .language-badge {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1976d2;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .guide-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stars {
            color: #ffc107;
        }

        .guide-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .guide-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-guide {
            flex: 1;
            padding: 0.8rem;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-view {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-view:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-2px);
        }

        .btn-bookmark {
            background: linear-gradient(135deg, #ffc107, #ffb300);
            color: white;
        }

        .btn-bookmark:hover {
            background: linear-gradient(135deg, #ffb300, #ff8f00);
            transform: translateY(-2px);
        }

        /* Right Side Sponsor Buttons */
        .sponsor-buttons {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .sponsor-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            min-width: 140px;
            text-align: center;
        }

        .sponsor-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea584);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .sponsor-btn.login-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .sponsor-btn.login-btn:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        /* Enhanced Login Buttons Styling */
        .login-btn-tourist:hover {
            background: linear-gradient(135deg, #00b4d8, #0096c7) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 209, 199, 0.5) !important;
        }

        .login-btn-guide:hover {
            background: linear-gradient(135deg, #20c997, #198754) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.5) !important;
        }

        .login-btn-tourist::before,
        .login-btn-guide::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }

        .login-btn-tourist:hover::before,
        .login-btn-guide:hover::before {
            width: 300px;
            height: 300px;
        }

        /* âœ… FIXED: Login buttons - Base styling for text visibility */
        .login-btn-tourist,
        .login-btn-guide {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            color: white !important;
            font-weight: 600 !important;
            text-align: center !important;
            white-space: nowrap !important;
            position: relative;
            z-index: 10;
        }

        /* Ensure text spans are always visible (override d-none d-md-inline) */
        .login-btn-tourist span,
        .login-btn-guide span {
            display: inline !important;
            color: white !important;
            font-size: inherit !important;
        }

        /* Mobile responsiveness for login buttons */
        @media (max-width: 768px) {
            .login-buttons-container {
                flex-direction: row !important;
                gap: 6px !important;
                width: 100%;
            }
            
            .login-btn-tourist,
            .login-btn-guide {
                flex: 1;
                padding: 8px 10px !important;
                font-size: 13px !important;
                min-width: auto;
                border-radius: 18px !important;
            }

            /* Show text on mobile for both buttons */
            .login-btn-tourist span,
            .login-btn-guide span {
                display: inline !important;
            }

            /* Hide icon on very small screens to make room for text */
            @media (max-width: 480px) {
                .login-btn-tourist i,
                .login-btn-guide i {
                    display: none !important;
                }

                .login-btn-tourist,
                .login-btn-guide {
                    padding: 8px 8px !important;
                    font-size: 12px !important;
                }
            }
        }

        /* Management Center Button */
        .management-center {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffc107, #ffb300);
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(255, 193, 7, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .management-center:hover {
            background: linear-gradient(135deg, #ffb300, #ff8f00);
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 193, 7, 0.5);
        }

        /* Mobile Responsive - Complete Version */
        @media (max-width: 768px) {
            /* Basic structure adjustments */
            body {
                overflow-x: hidden;
            }
            
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            /* Navigation adjustments */
            .navbar {
                padding: 8px 0;
            }
            
            .navbar-brand {
                font-size: 1.1rem;
            }
            
            .navbar .d-flex {
                flex-direction: row;
                align-items: center;
                gap: 8px;
                width: auto;
            }
            
            .navbar .btn {
                font-size: 12px;
                padding: 6px 12px;
                white-space: nowrap;
            }
            
            .dropdown-menu {
                min-width: 140px !important;
                right: 0;
                left: auto;
            }
            
            /* Hero section adjustments */
            .hero-section {
                min-height: 100vh;
                padding: 20px 0;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
            
            .hero-content {
                text-align: center;
                padding: 0 20px;
                max-width: 100%;
            }
            
            .hero-content h1 {
                font-size: 2rem;
                margin-bottom: 1rem;
            }
            
            .hero-content p {
                font-size: 1rem;
                margin-bottom: 2rem;
                line-height: 1.6;
            }
            
            /* Language switcher */
            .language-switcher-center {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 0 auto 2rem auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                width: 100%;
                padding: 0 20px;
                box-sizing: border-box;
            }
            
            .lang-btn-jp, .lang-btn-en {
                width: 100%;
                max-width: 280px;
                font-size: 14px;
                padding: 10px 16px;
                box-sizing: border-box;
                border-radius: 25px;
            }
            
            /* Hero buttons */
            .hero-buttons {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 12px;
                margin: 0 auto;
                padding: 0 20px;
                width: 100%;
                max-width: 280px;
            }
            
            .btn-hero {
                width: 100%;
                font-size: 14px;
                padding: 12px 20px;
                box-sizing: border-box;
                border-radius: 25px;
            }
            
            /* Sponsor buttons */
            .sponsor-buttons {
                position: relative;
                right: auto;
                top: auto;
                transform: none;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 20px auto;
                padding: 0 20px;
                gap: 10px;
                max-width: 280px;
                width: 100%;
            }
            
            .sponsor-btn {
                width: 100%;
                font-size: 14px;
                padding: 10px 16px;
                box-sizing: border-box;
                border-radius: 20px;
            }
            
            /* Main content */
            .main-content {
                padding: 40px 0 !important;
            }
            
            .filter-section {
                padding: 20px !important;
                margin: 0 10px;
            }
            
            .filter-section .d-flex {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .filter-section .form-select,
            .filter-section .form-control {
                width: 100% !important;
                min-width: auto !important;
                font-size: 14px;
                padding: 10px;
                box-sizing: border-box;
            }
            
            /* Guide cards */
            .guide-card {
                margin-bottom: 15px;
            }
            
            .guide-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-guide {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            /* Management center button */
            .management-center {
                position: fixed;
                bottom: 15px;
                right: 15px;
                transform: none;
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            /* Modals */
            .modal-dialog {
                margin: 5px;
                max-width: calc(100vw - 10px);
                height: calc(100vh - 10px);
            }
            
            .modal-content {
                height: 100%;
                border-radius: 10px;
            }
            
            .modal-body {
                padding: 15px;
                overflow-y: auto;
            }
            
            .modal-body .form-control,
            .modal-body .form-select {
                font-size: 14px;
                padding: 10px;
            }
            
            .modal-body .btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            /* Footer adjustments */
            .footer {
                padding: 20px 0;
            }
            
            .footer .row > .col-md-2,
            .footer .row > .col-md-3 {
                margin-bottom: 15px;
            }
            
            /* Tables */
            .table-responsive {
                font-size: 12px;
            }
            
            /* Search results */
            .search-results {
                padding: 10px;
            }
            
            /* Pagination */
            .pagination {
                justify-content: center;
            }
            
            .page-link {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body class="theme-ocean">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <div class="logo-container">
                    <img src="assets/images/tomotrip-logo.png" alt="TomoTrip Logo" onload="console.log('âœ… Logo loaded successfully from:', this.src)" onerror="console.error('âŒ Logo load failed:', this.src); this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;font-size: 24px; color: white;&quot;>T</span>';" />
                </div>
                <div class="brand-text">
                    <span class="brand-name">TomoTrip</span>
                    <span class="brand-tagline">ç‰¹åˆ¥ãªæ—…ã®ä½“é¨“ã‚’</span>
                    <span class="brand-subtitle">åœ°å…ƒã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«è¦³å…‰å®¢ãŒçŸ¥ã‚‰ãªã„éš ã‚ŒãŸåæ‰€ã‚’ç™ºè¦‹ã—ã‚ˆã†</span>
                </div>
            </a>
            
            <div class="d-flex align-items-center gap-2 flex-wrap">
                <a href="sponsor-list.html" class="btn btn-outline-primary btn-sm" id="sponsorListBtn" title="å”è³›åº—ä¸€è¦§ã‚’è¦‹ã‚‹" style="font-size: 0.75rem; padding: 5px 10px; border-radius: 20px; text-decoration: none; white-space: nowrap;">
                    <i class="bi bi-building"></i> å”è³›åº—ä¸€è¦§
                </a>
                <button class="btn btn-warning btn-sm" id="sponsorEditBtn" title="å”è³›åº—ç·¨é›†" style="font-size: 0.75rem; padding: 5px 10px; border-radius: 20px; white-space: nowrap;">
                    <i class="bi bi-pencil-square"></i> å”è³›åº—ç·¨é›†
                </button>
                <a href="sponsor-dashboard.html" class="btn btn-success btn-sm" id="dashboardBtn" title="ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" style="font-size: 0.75rem; padding: 5px 10px; border-radius: 20px; text-decoration: none; white-space: nowrap;">
                    <i class="bi bi-speedometer2"></i> ç®¡ç†
                </a>
                <div class="login-buttons-container d-flex gap-1">
                    <button class="btn login-btn-tourist btn-sm" id="directTouristLoginBtn" type="button" style="background: linear-gradient(135deg, #4fd1c7, #00b4d8); color: white; border: none; padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 0.8rem; transition: all 0.3s ease;">
                        <i class="bi bi-person-circle me-1"></i><span class="d-none d-md-inline">è¦³å…‰å®¢</span>
                    </button>
                    <button class="btn login-btn-guide btn-sm" id="directGuideLoginBtn" type="button" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 0.8rem; transition: all 0.3s ease;">
                        <i class="bi bi-person-badge me-1"></i><span class="d-none d-md-inline">ã‚¬ã‚¤ãƒ‰</span>
                    </button>
                </div>
                <button class="btn btn-primary btn-sm" id="registerBtn" style="font-size: 0.8rem; padding: 6px 12px; border-radius: 20px;">æ–°è¦ç™»éŒ²</button>
            </div>
        </div>
    </nav>

    <!-- Registration Form Container (right below the nav) -->
    <div id="registrationFormContainer" style="display: none;">
        <!-- Form will be inserted here dynamically -->
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                    <!-- Language Switcher - Perfectly Centered -->
                    <div class="language-switcher-center text-center mb-4" style="display: flex !important; justify-content: center !important; align-items: center !important; width: 100% !important;">
                        <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3" style="margin: 0 auto !important; width: fit-content !important;">
                            <button class="lang-btn-jp btn" id="jpBtn" style="background: linear-gradient(135deg, #ff6b9d, #ff6b35); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3); transition: all 0.3s ease; min-width: 150px; text-align: center !important; cursor: pointer;">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                            <button class="lang-btn-en btn" id="enBtn" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3); transition: all 0.3s ease; min-width: 150px; text-align: center !important; cursor: pointer;">ğŸ‡ºğŸ‡¸ English</button>
                        </div>
                    </div>

                    <!-- Hero Content - Balanced Layout -->
                    <div class="hero-content text-center" style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%;">
                        <div class="hero-title-container mb-4" style="display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 20px; width: 100%; max-width: 600px;">
                            <div class="hero-logo" style="flex-shrink: 0;">
                                <img src="assets/images/tomotrip-logo.png" alt="TomoTrip Logo" class="modal-logo" />
                            </div>
                            <h1 class="display-4 fw-bold text-white" style="text-align: left; margin: 0;">ç‰¹åˆ¥ãªæ—…ã®ä½“é¨“ã‚’</h1>
                        </div>
                        <p class="lead text-white mb-5" style="text-align: center; max-width: 600px;">åœ°å…ƒã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«è¦³å…‰å®¢ãŒçŸ¥ã‚‰ãªã„éš ã‚ŒãŸåæ‰€ã‚’ç™ºè¦‹ã—ã‚ˆã†</p>
                        <div class="hero-buttons" style="display: flex; justify-content: center; width: 100%;">
                            <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3 flex-wrap" style="width: fit-content;">
                                <button class="btn-hero btn-primary-hero btn" id="findGuideBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; min-width: 150px; color: white; text-align: center;">ã‚¬ã‚¤ãƒ‰ã‚’æ¢ã™</button>
                                <a href="sponsor-list.html" class="btn-hero btn" id="heroSponsorListBtn" style="background: linear-gradient(135deg, #00b4d8, #0096c7); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(0, 180, 216, 0.3); transition: all 0.3s ease; min-width: 150px; color: white; text-align: center; text-decoration: none;"><i class="bi bi-building me-1"></i>å”è³›åº—ã‚’è¦‹ã‚‹</a>
                                <button class="btn-hero btn-outline-hero btn" id="contactBtn" style="background: linear-gradient(135deg, #f093fb, #f5576c); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3); transition: all 0.3s ease; min-width: 150px; color: white; text-align: center;">ãŠå•ã„åˆã‚ã›</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Management Center Button - Desktop -->
    <button class="management-center d-none d-lg-block" id="managementBtn" title="Management Center" style="position: fixed; bottom: 30px; right: 30px; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #ffed4e); border: none; font-size: 24px; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4); transition: all 0.3s ease; cursor: pointer;">ğŸ†</button>
    
    <!-- Management Center Button - Mobile -->
    <button class="management-center-mobile d-lg-none position-fixed" id="managementBtnMobile" title="Management Center" style="bottom: 80px; right: 20px; z-index: 1000; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #ffed4e); border: none; font-size: 20px; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); transition: all 0.3s ease; cursor: pointer;">ğŸ†</button>

    <!-- Admin Mode Toggle Button -->
    <button class="admin-mode-toggle d-none d-lg-block" id="adminModeToggleBtn" data-action="toggle-admin-mode" title="ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰" style="position: fixed; bottom: 30px; right: 110px; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #dc3545, #c82333); border: none; font-size: 24px; color: white; box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4); transition: all 0.3s ease; cursor: pointer;">âš™ï¸</button>

    <!-- Main Content Section -->
    <section class="main-content" style="padding: 80px 0; background: #f8f9fa;">
        <div class="container">
            <!-- Filter Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="filter-section" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <div class="d-flex flex-wrap gap-3 align-items-center justify-content-between">
                            <div class="d-flex flex-wrap gap-3">
                                <select class="form-select" style="width: auto; min-width: 200px;" id="locationFilter">
                                    <!-- éƒ½é“åºœçœŒé¸æŠè‚¢ã¯ prefecture-selector.mjs ã§å‹•çš„ç”Ÿæˆ -->
                                </select>

                                <select class="form-select" style="width: auto; min-width: 160px;" id="languageFilter">
                                    <option value="">ã™ã¹ã¦ã®è¨€èª</option>
                                    <optgroup label="Asian Languages">
                                        <option value="japanese">æ—¥æœ¬èª</option>
                                        <option value="english">è‹±èª</option>
                                        <option value="chinese">ä¸­å›½èªï¼ˆç°¡ä½“ï¼‰</option>
                                        <option value="chinese_traditional">ä¸­å›½èªï¼ˆç¹ä½“ï¼‰</option>
                                        <option value="korean">éŸ“å›½èª</option>
                                        <option value="thai">ã‚¿ã‚¤èª</option>
                                        <option value="vietnamese">ãƒ™ãƒˆãƒŠãƒ èª</option>
                                        <option value="indonesian">ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èª</option>
                                        <option value="tagalog">ã‚¿ã‚¬ãƒ­ã‚°èªï¼ˆãƒ•ã‚£ãƒªãƒ”ãƒ³ï¼‰</option>
                                        <option value="hindi">ãƒ’ãƒ³ãƒ‡ã‚£ãƒ¼èª</option>
                                    </optgroup>
                                    <optgroup label="ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘è¨€èª">
                                        <option value="spanish">ã‚¹ãƒšã‚¤ãƒ³èª</option>
                                        <option value="french">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
                                        <option value="german">ãƒ‰ã‚¤ãƒ„èª</option>
                                        <option value="italian">ã‚¤ã‚¿ãƒªã‚¢èª</option>
                                        <option value="portuguese">ãƒãƒ«ãƒˆã‚¬ãƒ«èª</option>
                                        <option value="russian">ãƒ­ã‚·ã‚¢èª</option>
                                        <option value="dutch">ã‚ªãƒ©ãƒ³ãƒ€èª</option>
                                        <option value="swedish">ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª</option>
                                    </optgroup>
                                    <optgroup label="ãã®ä»–ã®è¨€èª">
                                        <option value="arabic">ã‚¢ãƒ©ãƒ“ã‚¢èª</option>
                                        <option value="hebrew">ãƒ˜ãƒ–ãƒ©ã‚¤èª</option>
                                        <option value="turkish">ãƒˆãƒ«ã‚³èª</option>
                                        <option value="swahili">ã‚¹ãƒ¯ãƒ’ãƒªèª</option>
                                    </optgroup>
                                </select>
                                
                                <select class="form-select" style="width: auto; min-width: 160px;" id="priceFilter">
                                    <option value="">ã™ã¹ã¦ã®ä¾¡æ ¼</option>
                                    <option value="budget">Â¥6,000ï½Â¥10,000</option>
                                    <option value="premium">Â¥10,001ï½Â¥20,000</option>
                                    <option value="luxury">Â¥20,001+</option>
                                </select>
                                
                                <input type="text" class="form-control" style="width: auto; min-width: 200px;" id="keywordInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢...">
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary" id="searchBtn" data-action="search">æ¤œç´¢</button>
                                <button class="btn btn-outline-secondary" id="resetBtn" data-action="reset">ãƒªã‚»ãƒƒãƒˆ</button>
                            </div>
                        </div>
                        
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                            <small class="text-muted" id="guideCounter">èª­ã¿è¾¼ã¿ä¸­...</small>
                            <small class="text-info" id="totalGuideCounter">å…¨ä½“: èª­ã¿è¾¼ã¿ä¸­...</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guide Cards Section -->
            <div class="row" id="guide-list">
                <!-- Guide cards will be populated here -->
            </div>
            
            <!-- Pagination Controls -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-outline-secondary" id="prevPageBtn" disabled>â† å‰ã®ãƒšãƒ¼ã‚¸</button>
                        <div class="pagination-info">
                            <span id="pageInfo" class="fw-bold">ãƒšãƒ¼ã‚¸ 1</span>
                            <small class="text-muted ms-2">(<span id="displayRange">1-12</span> ä»¶è¡¨ç¤ºä¸­)</small>
                        </div>
                        <button class="btn btn-outline-primary" id="nextPageBtn">æ¬¡ã®ãƒšãƒ¼ã‚¸ â†’</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Detailed Guide Registration Form (with Phone Verification & Document Upload) -->
    <div id="detailedGuideRegistrationForm" style="display: none; margin-top: 2rem;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="guide-container" style="background: white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15); margin: 2rem 0;">
                        <div class="guide-header" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 2rem; border-radius: 20px 20px 0 0; text-align: center;">
                            <h1><i class="bi bi-person-plus-fill me-2"></i>æ–°è¦ã‚¬ã‚¤ãƒ‰ç™»éŒ²</h1>
                            <p class="mb-0">æµ…è‰è¦³å…‰æ¡ˆå†…æ‰€ - ã‚¬ã‚¤ãƒ‰ã‚¹ã‚¿ãƒƒãƒ•å‹Ÿé›†</p>
                        </div>
                        
                        <div class="p-4">
                            <form id="detailedGuideForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="detailedGuideName" required>
                                            <label for="detailedGuideName"><i class="bi bi-person me-1"></i>ã‚¬ã‚¤ãƒ‰å</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="email" class="form-control" id="detailedGuideEmail" required>
                                            <label for="detailedGuideEmail"><i class="bi bi-envelope me-1"></i>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- é›»è©±èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                                <h5 class="mb-3 text-success"><i class="bi bi-telephone-fill me-2"></i>é›»è©±èªè¨¼</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="tel" class="form-control" id="detailedGuidePhone" required>
                                            <label for="detailedGuidePhone"><i class="bi bi-telephone me-1"></i>é›»è©±ç•ªå·</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-success w-100" id="sendVerificationCode" style="height: 58px;">
                                            <i class="bi bi-send me-1"></i>èªè¨¼ã‚³ãƒ¼ãƒ‰é€ä¿¡
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="verificationCode" placeholder="èªè¨¼ã‚³ãƒ¼ãƒ‰" maxlength="6">
                                            <label for="verificationCode"><i class="bi bi-shield-check me-1"></i>èªè¨¼ã‚³ãƒ¼ãƒ‰</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-success" id="verifyPhoneCode" disabled>
                                            <i class="bi bi-check-circle me-1"></i>é›»è©±ç•ªå·ã‚’èªè¨¼ã™ã‚‹
                                        </button>
                                        <span id="phoneVerificationStatus" class="text-muted ms-3"></span>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideGender" required>
                                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                                <option value="male">ç”·æ€§</option>
                                                <option value="female">å¥³æ€§</option>
                                                <option value="other">ãã®ä»–</option>
                                            </select>
                                            <label for="detailedGuideGender"><i class="bi bi-people me-1"></i>æ€§åˆ¥</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="detailedGuideAge" min="18" max="80" required>
                                            <label for="detailedGuideAge"><i class="bi bi-calendar me-1"></i>å¹´é½¢</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideExperience" required>
                                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                                <option value="beginner">åˆå¿ƒè€…ï¼ˆ1å¹´æœªæº€ï¼‰</option>
                                                <option value="intermediate">ä¸­ç´šè€…ï¼ˆ1-3å¹´ï¼‰</option>
                                                <option value="advanced">ä¸Šç´šè€…ï¼ˆ3å¹´ä»¥ä¸Šï¼‰</option>
                                            </select>
                                            <label for="detailedGuideExperience"><i class="bi bi-award me-1"></i>çµŒé¨“ãƒ¬ãƒ™ãƒ«</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- èº«åˆ†è¨¼æ˜æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                                <h5 class="mb-3 text-success"><i class="bi bi-card-checklist me-2"></i>èº«åˆ†è¨¼æ˜æ›¸</h5>
                                
                                <!-- è¨¼æ˜æ›¸ã‚¿ã‚¤ãƒ—é¸æŠ -->
                                <div class="form-floating mb-3">
                                    <select class="form-control" id="documentType" required onchange="updateDocumentUpload()">
                                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        <option value="drivers_license">é‹è»¢å…è¨±è¨¼ï¼ˆè¡¨é¢ãƒ»è£é¢ã®2æšå¿…é ˆï¼‰</option>
                                        <option value="passport">ãƒ‘ã‚¹ãƒãƒ¼ãƒˆï¼ˆå†™çœŸãƒšãƒ¼ã‚¸1æšï¼‰</option>
                                        <option value="residence_card">ä½æ°‘ç¥¨ï¼ˆ1æšï¼‰</option>
                                        <option value="insurance_card">å¥åº·ä¿é™ºè¨¼ï¼ˆè¡¨é¢ãƒ»è£é¢ã®2æšå¿…é ˆï¼‰</option>
                                        <option value="mynumber_card">ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆè¡¨é¢ã®ã¿1æšï¼‰</option>
                                    </select>
                                    <label for="documentType"><i class="bi bi-card-list me-1"></i>æå‡ºã™ã‚‹è¨¼æ˜æ›¸ã‚¿ã‚¤ãƒ—</label>
                                </div>
                                
                                <!-- å‹•çš„è¨¼æ˜æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¬„ -->
                                <div id="documentUploadArea" style="display: none;">
                                    <div class="alert alert-info" id="documentInstructions"></div>
                                    <div class="row mb-3" id="documentUploadCards"></div>
                                </div>
                                
                                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                                <h5 class="mb-3 text-info"><i class="bi bi-person-square me-2"></i>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="card border-2 border-dashed border-info" style="min-height: 150px;">
                                            <div class="card-body text-center">
                                                <i class="bi bi-camera fs-1 text-info mb-2"></i>
                                                <p class="text-muted">ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã‚‹å†™çœŸ</p>
                                                <input type="file" class="form-control" id="profilePhoto" accept="image/*" required onchange="previewProfilePhoto(this)">
                                                <small class="text-muted">é¢¨æ™¯ãƒ»äººç‰©ãƒ»ä»»æ„ã®å†™çœŸOK<br>ï¼ˆJPGã€PNGå¯¾å¿œï¼‰</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="profilePhotoPreviewCard" style="display: none;">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h6>
                                                <img id="profilePhotoPreview" class="img-fluid" style="max-height: 120px; border-radius: 10px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
                                <div class="row mb-3" id="imagePreviewArea" style="display: none;">
                                    <div id="documentPreviewCards"></div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h6>
                                                <img id="profilePreview" class="img-fluid" style="max-height: 200px; border-radius: 10px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <select class="form-control" id="detailedGuideLanguages" multiple required style="min-height: 120px;">
                                        <option value="japanese">æ—¥æœ¬èª</option>
                                        <option value="english">è‹±èª</option>
                                        <option value="chinese">ä¸­å›½èª</option>
                                        <option value="korean">éŸ“å›½èª</option>
                                        <option value="spanish">ã‚¹ãƒšã‚¤ãƒ³èª</option>
                                        <option value="french">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
                                        <option value="german">ãƒ‰ã‚¤ãƒ„èª</option>
                                        <option value="italian">ã‚¤ã‚¿ãƒªã‚¢èª</option>
                                    </select>
                                    <label for="detailedGuideLanguages"><i class="bi bi-translate me-1"></i>å¯¾å¿œè¨€èªï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="detailedGuideIntroduction" style="height: 120px;" required></textarea>
                                    <label for="detailedGuideIntroduction"><i class="bi bi-chat-text me-1"></i>è‡ªå·±ç´¹ä»‹ãƒ»ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆ</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="detailedGuideSpecialties" style="height: 100px;" required></textarea>
                                    <label for="detailedGuideSpecialties"><i class="bi bi-star me-1"></i>å¾—æ„åˆ†é‡ãƒ»å°‚é–€ã‚¨ãƒªã‚¢</label>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="detailedGuideSessionRate" min="6000" max="25000" step="500" required>
                                            <label for="detailedGuideSessionRate"><i class="bi bi-currency-yen me-1"></i>å¸Œæœ›ã‚»ãƒƒã‚·ãƒ§ãƒ³æ–™é‡‘ï¼ˆå††ï¼‰</label>
                                            <small class="text-muted">1ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ2ã€œ3æ™‚é–“ç¨‹åº¦ï¼‰ã®æ–™é‡‘ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼ˆï¿¥6,000ã€œï¼‰</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideAvailability" required>
                                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                                <option value="weekdays">å¹³æ—¥ã®ã¿</option>
                                                <option value="weekends">é€±æœ«ã®ã¿</option>
                                                <option value="both">å¹³æ—¥ãƒ»é€±æœ«ä¸¡æ–¹</option>
                                            </select>
                                            <label for="detailedGuideAvailability"><i class="bi bi-calendar-week me-1"></i>ç¨¼åƒå¯èƒ½æ—¥</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="detailedAgreeTerms" required>
                                    <label class="form-check-label" for="detailedAgreeTerms">
                                        ã‚¬ã‚¤ãƒ‰è¦ç´„åŠã³åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™
                                    </label>
                                </div>
                                
                                <!-- ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
                                <div id="guideCardPreviewArea" style="display: none;" class="mb-4">
                                    <h5 class="mb-3 text-primary"><i class="bi bi-eye me-2"></i>ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h5>
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>ã“ã‚ŒãŒã‚ãªãŸã®ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ã§ã™ã€‚è¦³å…‰å®¢ã«è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                                    </div>
                                    <div class="row justify-content-center">
                                        <div class="col-md-8">
                                            <div id="guideCardPreview" class="card shadow-lg border-0" style="border-radius: 15px; overflow: hidden;">
                                                <!-- Dynamic guide card content will be inserted here -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="button" class="btn btn-outline-primary" onclick="updateGuideCardPreview()">
                                            <i class="bi bi-arrow-clockwise me-2"></i>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-info mb-3" onclick="showGuideCardPreview()" style="border-radius: 10px;">
                                        <i class="bi bi-eye me-2"></i>ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
                                    </button>
                                    <button type="submit" class="btn btn-guide" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px; border-radius: 10px; color: white; font-weight: 600;">
                                        <i class="bi bi-check-circle me-2"></i>ã‚¬ã‚¤ãƒ‰ç™»éŒ²ç”³è«‹
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="guideRegistrationCancelBtn">
                                        <i class="bi bi-x-circle me-2"></i>ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tourist Registration Modal - Completely Japanese with Verification -->
    <div class="modal fade" id="registrationModal" tabindex="-1" aria-labelledby="registrationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: none;">
                <div class="modal-header border-0 position-relative" 
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%); 
                            color: white; border-radius: 20px 20px 0 0; padding: 25px 30px;">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="registrationModalLabel">
                        <div class="me-3" style="width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-person-plus-fill" style="font-size: 22px;"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem;">è¦³å…‰å®¢ç™»éŒ²</div>
                            <small style="opacity: 0.9; font-weight: normal;">é›»è©±èªè¨¼ã¨èº«åˆ†è¨¼æ˜æ›¸ã®æå‡ºãŒå¿…è¦ã§ã™</small>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹" 
                            style="font-size: 1.2rem; padding: 10px;"></button>
                </div>
                
                <div class="modal-body p-0" style="max-height: 70vh; overflow-y: auto;">
                    <!-- Step Indicator -->
                    <div class="text-center mb-4 px-4 py-3" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid #dee2e6;">
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="step-item active" id="step1-indicator">
                                <span class="badge bg-primary rounded-circle me-2">1</span>
                                åŸºæœ¬æƒ…å ±
                            </div>
                            <div class="mx-3">â†’</div>
                            <div class="step-item" id="step2-indicator">
                                <span class="badge bg-secondary rounded-circle me-2">2</span>
                                é›»è©±èªè¨¼
                            </div>
                            <div class="mx-3">â†’</div>
                            <div class="step-item" id="step3-indicator">
                                <span class="badge bg-secondary rounded-circle me-2">3</span>
                                èº«åˆ†è¨¼æ˜æ›¸
                            </div>
                        </div>
                    </div>

                    <form id="touristRegistrationForm">
                        <!-- Step 1: Basic Information -->
                        <div class="step-content active" id="step1Content">
                            <div class="p-4">
                                <div class="alert alert-info border-0 mb-4" 
                                     style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 15px;">
                                    <div class="d-flex align-items-start">
                                        <i class="bi bi-info-circle-fill text-primary me-3" style="font-size: 1.5rem; margin-top: 2px;"></i>
                                        <div>
                                            <h6 class="fw-bold mb-2 text-primary">è¦³å…‰å®¢ç™»éŒ²ã«ã¤ã„ã¦</h6>
                                            <small class="text-dark">
                                                TomoTripã§ã¯ã€ä¿¡é ¼ã§ãã‚‹åœ°å…ƒã‚¬ã‚¤ãƒ‰ã¨ã®å®‰å…¨ãªå‡ºä¼šã„ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
                                                ã‚¬ã‚¤ãƒ‰ã®è©³ç´°æƒ…å ±é–²è¦§ã‚„ãŠå•ã„åˆã‚ã›ã‚’ã”åˆ©ç”¨ã„ãŸã ããŸã‚ã€è¦³å…‰å®¢ã¨ã—ã¦ã®ç™»éŒ²ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <h4 class="mb-3">åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h4>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="touristFirstName" class="form-label">å</label>
                                        <input type="text" class="form-control" id="touristFirstName" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="touristLastName" class="form-label">å§“</label>
                                        <input type="text" class="form-control" id="touristLastName" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristEmail" class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                    <input type="email" class="form-control" id="touristEmail" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristPhone" class="form-label">é›»è©±ç•ªå·</label>
                                    <input type="tel" class="form-control" id="touristPhone" placeholder="090-1234-5678" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    <div class="form-text">SMSèªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å—ä¿¡ã™ã‚‹é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristCountry" class="form-label">å›½ç±</label>
                                    <select class="form-control" id="touristCountry" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        <option value="japan">æ—¥æœ¬</option>
                                        <option value="usa">ã‚¢ãƒ¡ãƒªã‚«åˆè¡†å›½</option>
                                        <option value="china">ä¸­å›½</option>
                                        <option value="korea">éŸ“å›½</option>
                                        <option value="taiwan">å°æ¹¾</option>
                                        <option value="other">ãã®ä»–</option>
                                    </select>
                                </div>
                                
                                <div class="d-flex justify-content-end gap-3 mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="clearRegistrationModal(); bootstrap.Modal.getInstance(document.getElementById('registrationModal')).hide();" style="border-radius: 25px; padding: 12px 30px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                    <button type="button" class="btn btn-primary" onclick="goToStep2Modal()" style="border-radius: 25px; padding: 12px 30px;">æ¬¡ã¸</button>
                                </div>
                                
                                <div class="row g-3 mt-1">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="touristVisitDuration" 
                                                    style="border-radius: 12px; border: 2px solid #e9ecef; height: 58px;">
                                                <option value="">æ»åœ¨æœŸé–“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                                <option value="1-3days">1ã€œ3æ—¥é–“</option>
                                                <option value="4-7days">4ã€œ7æ—¥é–“</option>
                                                <option value="1-2weeks">1ã€œ2é€±é–“</option>
                                                <option value="3-4weeks">3ã€œ4é€±é–“</option>
                                                <option value="1month+">1ãƒ¶æœˆä»¥ä¸Š</option>
                                            </select>
                                            <label for="touristVisitDuration">
                                                <i class="bi bi-calendar me-2 text-primary"></i>æ»åœ¨äºˆå®šæœŸé–“
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="touristPreferredLanguage" 
                                                    style="border-radius: 12px; border: 2px solid #e9ecef; height: 58px;">
                                                <option value="">å¸Œæœ›ã‚¬ã‚¤ãƒ‰è¨€èªã‚’é¸æŠ</option>
                                                <option value="japanese">æ—¥æœ¬èª</option>
                                                <option value="english">è‹±èª</option>
                                                <option value="chinese">ä¸­å›½èª</option>
                                                <option value="korean">éŸ“å›½èª</option>
                                                <option value="other">ãã®ä»–</option>
                                            </select>
                                            <label for="touristPreferredLanguage">
                                                <i class="bi bi-translate me-2 text-primary"></i>å¸Œæœ›ã‚¬ã‚¤ãƒ‰è¨€èª
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="touristInterests" 
                                                  placeholder="èˆˆå‘³ãƒ»å¸Œæœ›ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦ãã ã•ã„" 
                                                  style="border-radius: 12px; border: 2px solid #e9ecef; min-height: 100px; resize: vertical;"></textarea>
                                        <label for="touristInterests">
                                            <i class="bi bi-heart me-2 text-primary"></i>èˆˆå‘³ãƒ»å¸Œæœ›ï¼ˆè¦³å…‰åœ°ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãªã©ï¼‰
                                        </label>
                                    </div>
                                    <div class="form-text">è¡ŒããŸã„å ´æ‰€ã€ä½“é¨“ã—ãŸã„ã“ã¨ã€ç‰¹åˆ¥ãªã”è¦æœ›ãŒã‚ã‚Œã°è©³ã—ããŠæ›¸ããã ã•ã„</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Phone Verification -->
                        <div class="step-content" id="step2Content" style="display: none;">
                            <div class="p-4">
                                <h4 class="mb-3">é›»è©±ç•ªå·èªè¨¼</h4>
                                <div class="verification-box p-4 mb-3" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border-radius: 15px; border: 2px solid #2196f3;">
                                    <div class="text-center mb-3">
                                        <i class="bi bi-phone text-primary" style="font-size: 2.5rem;"></i>
                                        <h5 class="text-primary mt-2">ğŸ“± é›»è©±ç•ªå·èªè¨¼</h5>
                                    </div>
                                    <div class="alert alert-info" role="alert">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <strong>ç°¡å˜3ã‚¹ãƒ†ãƒƒãƒ—!</strong> SMSèªè¨¼ã‚³ãƒ¼ãƒ‰ã§æœ¬äººç¢ºèªã‚’è¡Œã„ã¾ã™
                                    </div>
                                    <p class="fw-bold mb-1" id="phoneDisplayModal"></p>
                                    
                                    <div class="mb-3" id="sendCodeSectionModal">
                                        <div class="d-grid gap-2">
                                            <button type="button" class="btn btn-primary btn-lg" id="sendCodeBtnModal" style="border-radius: 15px; padding: 15px;">
                                                <i class="bi bi-send-fill me-2"></i>ğŸ“² èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡
                                            </button>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted">
                                                <i class="bi bi-shield-check me-1"></i>å®‰å…¨ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã§å€‹äººæƒ…å ±ã‚’ä¿è­·
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3" id="verifyCodeSectionModal" style="display: none;">
                                        <label for="verificationCodeModal" class="form-label">èªè¨¼ã‚³ãƒ¼ãƒ‰ï¼ˆ6æ¡ï¼‰</label>
                                        <input type="text" class="form-control" id="verificationCodeModal" maxlength="6" placeholder="123456" style="border-radius: 15px; padding: 12px 20px; font-size: 1.5rem; text-align: center; letter-spacing: 0.5rem;">
                                        <div class="form-text">ãƒ‡ãƒ¢ç”¨èªè¨¼ã‚³ãƒ¼ãƒ‰: 123456</div>
                                        <button type="button" class="btn btn-primary w-100 mt-2" id="verifyCodeBtnModal" style="border-radius: 15px; padding: 12px;">èªè¨¼ã™ã‚‹</button>
                                    </div>
                                    
                                    <div class="text-success" id="verificationSuccessModal" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> é›»è©±ç•ªå·èªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸ
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep1Modal()" style="border-radius: 25px; padding: 12px 30px;">æˆ»ã‚‹</button>
                                    <button type="button" class="btn btn-primary" id="step2NextBtnModal" onclick="goToStep3Modal()" style="border-radius: 25px; padding: 12px 30px;">æ¬¡ã¸</button>
                                </div>

                                <!-- Phone Verification -->
                                <div class="verification-section mb-4">
                                    <h6 class="fw-bold mb-3 text-primary">
                                        <i class="bi bi-telephone-fill me-2"></i>é›»è©±ç•ªå·èªè¨¼
                                    </h6>
                                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                                        <div class="card-body p-4">
                                            <div class="row g-3">
                                                <div class="col-md-8">
                                                    <div class="form-floating">
                                                        <input type="tel" class="form-control" id="verificationPhone" 
                                                               placeholder="é›»è©±ç•ªå·" readonly 
                                                               style="border-radius: 10px; background-color: #f8f9fa;">
                                                        <label for="verificationPhone">èªè¨¼ç”¨é›»è©±ç•ªå·</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <button type="button" class="btn btn-outline-primary w-100 h-100" 
                                                            id="sendSmsBtn" style="border-radius: 10px; min-height: 58px;">
                                                        <i class="bi bi-send me-2"></i>SMSé€ä¿¡
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3" id="smsVerificationArea" style="display: none;">
                                                <div class="row g-3">
                                                    <div class="col-md-8">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" id="smsCode" 
                                                                   placeholder="èªè¨¼ã‚³ãƒ¼ãƒ‰" maxlength="6" 
                                                                   style="border-radius: 10px; font-family: monospace; font-size: 1.2rem; letter-spacing: 0.1em;">
                                                            <label for="smsCode">6æ¡ã®èªè¨¼ã‚³ãƒ¼ãƒ‰</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <button type="button" class="btn btn-success w-100 h-100" 
                                                                id="verifySmsBtn" style="border-radius: 10px; min-height: 58px;">
                                                            <i class="bi bi-check-circle me-2"></i>èªè¨¼
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="form-text text-center mt-2">
                                                    <i class="bi bi-clock me-1"></i>èªè¨¼ã‚³ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™: <span id="smsTimer">5:00</span>
                                                </div>
                                            </div>
                                            
                                            <div class="verification-status mt-3" id="phoneVerificationStatus">
                                                <div class="text-muted">
                                                    <i class="bi bi-info-circle me-2"></i>é›»è©±ç•ªå·èªè¨¼ãŒå¿…è¦ã§ã™
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Document Upload -->
                                <div class="verification-section">
                                    <h6 class="fw-bold mb-3 text-primary">
                                        <i class="bi bi-file-earmark-person me-2"></i>èº«åˆ†è¨¼æ˜æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                                    </h6>
                                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                                        <div class="card-body p-4">
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">èº«åˆ†è¨¼æ˜æ›¸ã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„ <span class="text-success">(å¤–å›½äººã®æ–¹ã‚‚OK)</span></label>
                                                <div class="row g-2">
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="passport" value="passport">
                                                        <label class="btn btn-outline-primary w-100" for="passport" style="border-radius: 10px;">
                                                            <i class="bi bi-bookmark-star me-2"></i>ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="license" value="license">
                                                        <label class="btn btn-outline-primary w-100" for="license" style="border-radius: 10px;">
                                                            <i class="bi bi-credit-card me-2"></i>é‹è»¢å…è¨±è¨¼
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="residence_card" value="residence_card">
                                                        <label class="btn btn-outline-success w-100" for="residence_card" style="border-radius: 10px;">
                                                            <i class="bi bi-person-badge me-2"></i>åœ¨ç•™ã‚«ãƒ¼ãƒ‰
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="special_resident" value="special_resident">
                                                        <label class="btn btn-outline-success w-100" for="special_resident" style="border-radius: 10px;">
                                                            <i class="bi bi-award me-2"></i>ç‰¹åˆ¥æ°¸ä½è€…è¨¼æ˜æ›¸
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="insurance_card" value="insurance_card">
                                                        <label class="btn btn-outline-info w-100" for="insurance_card" style="border-radius: 10px;">
                                                            <i class="bi bi-heart me-2"></i>å¥åº·ä¿é™ºè¨¼
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="student_id" value="student_id">
                                                        <label class="btn btn-outline-warning w-100" for="student_id" style="border-radius: 10px;">
                                                            <i class="bi bi-mortarboard me-2"></i>å­¦ç”Ÿè¨¼
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="mt-2">
                                                    <small class="text-muted">
                                                        <i class="bi bi-info-circle me-1"></i>
                                                        å¤–å›½ã®æ–¹: ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã€åœ¨ç•™ã‚«ãƒ¼ãƒ‰ã€ç‰¹åˆ¥æ°¸ä½è€…è¨¼æ˜æ›¸ãŒåˆ©ç”¨å¯èƒ½
                                                    </small>
                                                </div>
                                            </div>
                                            
                                            <div class="upload-area" id="documentUploadArea">
                                                <div class="alert alert-warning mb-3">
                                                    <i class="bi bi-lightbulb me-2"></i>
                                                    <strong>æå‡ºæ–¹æ³•:</strong> ä¸Šã§é¸æŠã—ãŸè¨¼æ˜æ›¸ã®ç¨®é¡ã«å¿œã˜ã¦ã€å¿…è¦ãªé¢ã‚’æ’®å½±ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„
                                                </div>
                                                
                                                <div class="row g-3 mb-3" id="uploadStepsGuide">
                                                    <div class="col-md-4">
                                                        <div class="card border-success h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-1-circle-fill text-success" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">è¨¼æ˜æ›¸ã‚’æº–å‚™</h6>
                                                                <p class="small text-muted">é¸æŠã—ãŸèº«åˆ†è¨¼æ˜æ›¸ã‚’æ‰‹å…ƒã«ç”¨æ„</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="card border-warning h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-2-circle-fill text-warning" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">æ’®å½±ãƒ»ã‚¹ã‚­ãƒ£ãƒ³</h6>
                                                                <p class="small text-muted">é®®æ˜ã«æ’®å½±ã€æ–‡å­—ãŒèª­ã‚ã‚‹ã‚ˆã†ã«</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="card border-primary h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-3-circle-fill text-primary" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h6>
                                                                <p class="small text-muted">ä¸‹ã®ãƒœã‚¿ãƒ³ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="border border-2 border-dashed border-primary rounded p-4 text-center" 
                                                     style="border-radius: 15px !important; background: linear-gradient(135deg, #f8f9ff, #f0f4ff);">
                                                    <i class="bi bi-cloud-upload text-primary mb-3" style="font-size: 3rem;"></i>
                                                    <h6 class="fw-bold text-primary">ğŸ“„ èº«åˆ†è¨¼æ˜æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h6>
                                                    <p class="text-muted mb-3">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</p>
                                                    <input type="file" class="form-control d-none" id="touristDocumentUpload" 
                                                           accept="image/*,.pdf" multiple>
                                                    <button type="button" class="btn btn-primary btn-lg" onclick="document.getElementById('touristDocumentUpload').click()" 
                                                            style="border-radius: 25px; padding: 12px 30px;">
                                                        <i class="bi bi-camera me-2"></i>ğŸ“± å†™çœŸã‚’é¸æŠãƒ»æ’®å½±
                                                    </button>
                                                    <div class="form-text mt-3">
                                                        <i class="bi bi-check-circle me-1 text-success"></i>
                                                        <strong>å¯¾å¿œå½¢å¼:</strong> JPG, PNG, PDFï¼ˆæœ€å¤§5MBï¼‰
                                                        <br>
                                                        <i class="bi bi-shield-check me-1 text-primary"></i>
                                                        <strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:</strong> ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã¯æš—å·åŒ–ã•ã‚Œã¦å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="uploaded-documents mt-3" id="uploadedDocuments" style="max-height: 200px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Document Upload -->
                        <div class="step-content" id="step3Content" style="display: none;">
                            <div class="p-4">
                                <h4 class="mb-3">èº«åˆ†è¨¼æ˜æ›¸ã®æå‡º</h4>
                                <div class="verification-box p-3 mb-3" style="background: #f8f9fa; border-radius: 15px; border-left: 4px solid #0984e3;">
                                    <p class="mb-3">ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®èº«åˆ†è¨¼æ˜æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š</p>
                                    <ul class="mb-3">
                                        <li>ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ</li>
                                        <li>é‹è»¢å…è¨±è¨¼</li>
                                        <li>ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰</li>
                                        <li>åœ¨ç•™ã‚«ãƒ¼ãƒ‰ï¼ˆå¤–å›½äººã®æ–¹ï¼‰</li>
                                    </ul>
                                    
                                    <div class="document-upload-area p-4 text-center" id="uploadAreaModal" style="border: 2px dashed #0984e3; border-radius: 15px; background: #f8f9fa; cursor: pointer;">
                                        <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #0984e3;"></i>
                                        <h5 class="mt-3">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</h5>
                                        <p class="text-muted">ã¾ãŸã¯</p>
                                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInputModal').click()" style="border-radius: 15px;">
                                            ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                                        </button>
                                        <input type="file" id="fileInputModal" accept="image/*,.pdf" style="display: none;">
                                        <div class="form-text mt-2">
                                            å¯¾å¿œå½¢å¼: JPG, PNG, PDFï¼ˆæœ€å¤§5MBï¼‰
                                        </div>
                                    </div>
                                    
                                    <div id="uploadPreviewModal" style="display: none;">
                                        <img id="previewImageModal" class="upload-preview" style="max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 1rem;" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
                                        <div class="mt-2">
                                            <span id="fileNameModal" class="fw-bold"></span>
                                            <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeFileModal()">å‰Šé™¤</button>
                                        </div>
                                    </div>
                                    
                                    <div class="text-success mt-3" id="uploadSuccessModal" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> èº«åˆ†è¨¼æ˜æ›¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep2FromStep3()" style="border-radius: 25px; padding: 12px 30px;">æˆ»ã‚‹</button>
                                    <button type="button" class="btn btn-primary" id="completeBtnModal" onclick="completeRegistrationModal()" disabled style="border-radius: 25px; padding: 12px 30px;">ç™»éŒ²å®Œäº†</button>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Marketing -->
                        <div class="border-top bg-light p-4" id="termsSection">
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="touristAgreeTerms" required>
                                <label class="form-check-label" for="touristAgreeTerms">
                                    <a href="#" class="text-primary fw-semibold">åˆ©ç”¨è¦ç´„</a>ã€
                                    <a href="#" class="text-primary fw-semibold">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>ã€
                                    <a href="#" class="text-primary fw-semibold">å€‹äººæƒ…å ±ä¿è­·æ–¹é‡</a>ã«åŒæ„ã—ã¾ã™ 
                                    <span class="text-danger">*</span>
                                </label>
                            </div>
                            
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="touristReceiveUpdates">
                                <label class="form-check-label" for="touristReceiveUpdates">
                                    æ–°ã—ã„ã‚¬ã‚¤ãƒ‰ã‚„ç‰¹åˆ¥ã‚ªãƒ•ã‚¡ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å—ã‘å–ã‚‹
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="modal-footer border-0 p-4 bg-light" style="border-radius: 0 0 20px 20px;">
                    <div class="w-100">
                        <div class="row g-2">
                            <div class="col-6">
                                <button type="button" class="btn btn-outline-secondary w-100" data-bs-dismiss="modal" 
                                        style="border-radius: 15px; padding: 12px; font-weight: 600;">
                                    <i class="bi bi-x-circle me-2"></i>ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="button" class="btn btn-primary w-100" id="nextStepBtn" 
                                        style="border-radius: 15px; padding: 12px; 
                                               background: linear-gradient(135deg, #667eea, #764ba2); 
                                               border: none; font-weight: 600;">
                                    <i class="bi bi-arrow-right me-2"></i>æ¬¡ã¸
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="loginModalLabel">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="login-type-indicator" id="loginTypeIndicator">
                            <span class="badge bg-primary fs-6" id="loginTypeBadge">Tourist Login</span>
                        </div>
                    </div>
                    
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i>Email Address
                            </label>
                            <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label fw-bold">
                                <i class="bi bi-lock me-2"></i>Password
                            </label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Remember me
                            </label>
                        </div>
                    </form>
                    
                    <div class="alert alert-info" style="border-radius: 10px;">
                        <small><i class="bi bi-info-circle me-2"></i>For first-time users, please register as a tourist first to access guide details and booking features.</small>
                    </div>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="loginSubmitBtn" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #6f42c1, #5a32a3); border: none;">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #20c997, #17a2b8); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="contactModalLabel">
                        <i class="bi bi-envelope me-2"></i>Contact Us
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label fw-bold">
                                <i class="bi bi-person me-2"></i>Name
                            </label>
                            <input type="text" class="form-control" id="contactName" placeholder="Your name" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i>Email
                            </label>
                            <input type="email" class="form-control" id="contactEmail" placeholder="your.email@example.com" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label fw-bold">
                                <i class="bi bi-chat-dots me-2"></i>Subject
                            </label>
                            <select class="form-select" id="contactSubject" required style="border-radius: 10px; padding: 12px;">
                                <option value="">Select a subject</option>
                                <option value="general">General Inquiry</option>
                                <option value="guide">Guide Registration</option>
                                <option value="sponsor">Sponsor Partnership</option>
                                <option value="technical">Technical Support</option>
                                <option value="feedback">Feedback</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label fw-bold">
                                <i class="bi bi-chat-text me-2"></i>Message
                            </label>
                            <textarea class="form-control" id="contactMessage" rows="4" placeholder="Please describe your inquiry or feedback..." required style="border-radius: 10px; padding: 12px;"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="contactSubmitBtn" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #20c997, #17a2b8); border: none;">
                        <i class="bi bi-send me-2"></i>Send Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" defer></script>
    <!-- âœ… FIXED (per Codex): Updated cache buster to force reload of latest button handlers -->
    <script src="button-setup-v3.js?v=20251123-codex-fix&t=1732342800000" defer></script>
    <!-- Ensure setupAllButtons is called after button-setup-v3.js loads -->
    <script defer>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ index.html: DOMContentLoaded triggered - calling setupAllButtons()');
            if (typeof setupAllButtons === 'function') {
                setTimeout(() => setupAllButtons(), 100);
                console.log('âœ… setupAllButtons() scheduled after 100ms delay');
            } else {
                console.warn('âš ï¸ setupAllButtons is not defined');
            }
        });
    </script>
    <script>
        // Complete English version with all Japanese functionality

        // Location mappings in English
        const locationNames = {
            'tokyo': 'Tokyo', 'kyoto': 'Kyoto', 'osaka': 'Osaka', 'hiroshima': 'Hiroshima',
            'hokkaido': 'Hokkaido', 'okinawa': 'Okinawa', 'nagano': 'Nagano',
            'aomori': 'Aomori', 'iwate': 'Iwate', 'miyagi': 'Miyagi', 'akita': 'Akita',
            'yamagata': 'Yamagata', 'fukushima': 'Fukushima', 'ibaraki': 'Ibaraki',
            'tochigi': 'Tochigi', 'gunma': 'Gunma', 'saitama': 'Saitama', 'chiba': 'Chiba',
            'kanagawa': 'Kanagawa', 'niigata': 'Niigata', 'toyama': 'Toyama',
            'ishikawa': 'Ishikawa', 'fukui': 'Fukui', 'yamanashi': 'Yamanashi',
            'gifu': 'Gifu', 'shizuoka': 'Shizuoka', 'aichi': 'Aichi', 'mie': 'Mie',
            'shiga': 'Shiga', 'hyogo': 'Hyogo', 'nara': 'Nara', 'wakayama': 'Wakayama',
            'tottori': 'Tottori', 'shimane': 'Shimane', 'okayama': 'Okayama',
            'yamaguchi': 'Yamaguchi', 'tokushima': 'Tokushima', 'kagawa': 'Kagawa',
            'ehime': 'Ehime', 'kochi': 'Kochi', 'fukuoka': 'Fukuoka', 'saga': 'Saga',
            'nagasaki': 'Nagasaki', 'kumamoto': 'Kumamoto', 'oita': 'Oita',
            'miyazaki': 'Miyazaki', 'kagoshima': 'Kagoshima'
        };

        // Guide data now managed by app-init.mjs - removed duplicate defaultGuides

        // Make redirect function globally available
        window.redirectToRegistration = function(guideId) {
            sessionStorage.setItem('pendingGuideId', guideId);
            window.location.href = '/tourist-registration-simple.html';
        };

        // Initialize location names for global access
        window.locationNames = locationNames;

        // Guide cards now handled by app-init.mjs module system

        // Display guides with pagination
        // Language detection for dynamic content
        function getCurrentPageLanguage() {
            const path = window.location.pathname;
            const filename = window.location.pathname.split('/').pop();
            return filename === 'index-en.html' ? 'en' : 'ja';
        }
        
        // Get localized text based on current page
        function getLocalizedText(key) {
            const lang = getCurrentPageLanguage();
            const translations = {
                ja: {
                    viewDetails: 'è©³ç´°ã‚’è¦‹ã‚‹',
                    perDay: 'ä¸€æ—¥ã‚ãŸã‚Š',
                    showMore: 'ã‚‚ã£ã¨è¦‹ã‚‹',
                    loading: 'èª­ã¿è¾¼ã¿ä¸­...',
                    culturalTours: 'æ–‡åŒ–ãƒ„ã‚¢ãƒ¼',
                    foodTours: 'ãƒ•ãƒ¼ãƒ‰ãƒ„ã‚¢ãƒ¼',
                    natureTours: 'è‡ªç„¶ãƒ„ã‚¢ãƒ¼',
                    historicalTours: 'æ­´å²ãƒ„ã‚¢ãƒ¼',
                    templesTours: 'å¯ºé™¢ãƒ»åº­åœ’'
                },
                en: {
                    viewDetails: 'View Details',
                    perDay: 'per day',
                    showMore: 'Show More',
                    loading: 'èª­ã¿è¾¼ã¿ä¸­...',
                    culturalTours: 'Cultural Tours',
                    foodTours: 'Food Tours',
                    natureTours: 'Nature Tours',
                    historicalTours: 'Historical Tours',
                    templesTours: 'Temples & Gardens'
                }
            };
            return translations[lang][key] || key;
        }

        // Guide display now handled by app-init.mjs module system
        
        // Update pagination controls
        function updatePaginationControls(totalGuides) {
            const totalPages = Math.ceil(totalGuides / guidesPerPage);
            const startIndex = (currentPage - 1) * guidesPerPage + 1;
            const endIndex = Math.min(currentPage * guidesPerPage, totalGuides);
            
            document.getElementById('pageInfo').textContent = `Page ${currentPage} / ${totalPages}`;
            document.getElementById('displayRange').textContent = `${startIndex}-${endIndex}`;
            
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
            nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
        }

        // Update guide counter
        function updateCounter() {
            const totalElement = document.getElementById('totalGuides');
            if (totalElement) {
                totalElement.textContent = currentGuides.length;
            }
            
            // æ¤œç´¢æ•°è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ  - å…¨ä½“ã®ã‚¬ã‚¤ãƒ‰æ•°ã¨æ¤œç´¢çµæœæ•°
            updateSearchCounters();
        }
        
        // æ¤œç´¢æ•°è¡¨ç¤ºã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
        function updateSearchCounters() {
            // ğŸ”§ FIX: ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°ã¯çµ±ä¸€ã•ã‚ŒãŸupdateGuideCountersé–¢æ•°ã‚’ä½¿ç”¨
            // ï¼ˆguide-renderer.mjsã®updateGuideCountersé–¢æ•°ã«å§”è¨—ã—ã¦é‡è¤‡ã‚’é¿ã‘ã‚‹ï¼‰
            if (typeof window.updateGuideCounters === 'function') {
                window.updateGuideCounters(currentGuides?.length || 0, currentGuides?.length || 0);
            }
        }

        // âš ï¸ DEPRECATED: Old event listener system (replaced by button-setup.js delegation)
        // This function is kept for legacy compatibility but should NOT add new listeners
        // All guide card buttons are now handled by button-setup.js delegated event handlers
        function addCardEventListeners() {
            console.log('â„¹ï¸ addCardEventListeners called (legacy - event delegation active in button-setup.js)');
            // No-op: Delegated event handlers in button-setup.js now handle all button clicks
            // This prevents duplicate event handlers and multiple toast messages
        }

        // Removed empty viewGuideDetail function - full implementation exists later

        // âœ… AppState ã«Set ãƒ™ãƒ¼ã‚¹ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯çŠ¶æ…‹ã‚’åˆæœŸåŒ–
        if (!window.AppState) {
            window.AppState = {};
        }
        if (!window.AppState.bookmarkedSet) {
            // localStorage ã‹ã‚‰ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’èª­ã¿è¾¼ã‚“ã§Set ã‚’ä½œæˆ
            const stored = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            window.AppState.bookmarkedSet = new Set(stored.map(id => String(id)));
        }

        // âœ… çµ±ä¸€ã•ã‚ŒãŸãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
        window.BookmarkManager = {
            add: function(guideId) {
                console.log('ğŸ“Œ Adding to bookmarks:', guideId);
                
                const id = String(guideId);
                
                // âœ… Set ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç®¡ç†
                if (!window.AppState.bookmarkedSet.has(id)) {
                    window.AppState.bookmarkedSet.add(id);
                    
                    // localStorage ã«é…åˆ—ã¨ã—ã¦æ°¸ç¶šåŒ–
                    const bookmarkedArray = Array.from(window.AppState.bookmarkedSet).map(id => parseInt(id) || id);
                    localStorage.setItem('bookmarkedGuides', JSON.stringify(bookmarkedArray));
                    
                    this.updateButtonStates();
                    this.showNotification('ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                    
                    // âœ… ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼åŒæœŸç”¨ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
                    window.dispatchEvent(new CustomEvent('bookmarkChanged'));
                    
                    console.log('âœ… Bookmark added:', id, 'Total bookmarks:', window.AppState.bookmarkedSet.size);
                    return true;
                } else {
                    console.log('âš ï¸ Guide already bookmarked:', guideId);
                    return false;
                }
            },
            
            remove: function(guideId) {
                console.log('ğŸ“Œ Removing from bookmarks:', guideId);
                
                const id = String(guideId);
                
                // âœ… Set ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç®¡ç†
                if (window.AppState.bookmarkedSet.has(id)) {
                    window.AppState.bookmarkedSet.delete(id);
                    
                    // localStorage ã«é…åˆ—ã¨ã—ã¦æ°¸ç¶šåŒ–
                    const bookmarkedArray = Array.from(window.AppState.bookmarkedSet).map(id => parseInt(id) || id);
                    localStorage.setItem('bookmarkedGuides', JSON.stringify(bookmarkedArray));
                    
                    this.updateButtonStates();
                    this.showNotification('ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
                    
                    // âœ… ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼åŒæœŸç”¨ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
                    window.dispatchEvent(new CustomEvent('bookmarkChanged'));
                    
                    console.log('âœ… Bookmark removed:', id, 'Remaining bookmarks:', window.AppState.bookmarkedSet.size);
                    return true;
                } else {
                    console.log('âš ï¸ Guide not in bookmarks:', guideId);
                    return false;
                }
            },
            
            toggle: function(guideId) {
                // âœ… Set ãƒ™ãƒ¼ã‚¹ã§ã®é«˜é€Ÿãƒã‚§ãƒƒã‚¯
                const id = String(guideId);
                
                if (window.AppState.bookmarkedSet.has(id)) {
                    return this.remove(guideId);
                } else {
                    return this.add(guideId);
                }
            },
            
            isBookmarked: function(guideId) {
                // âœ… Set ãƒ™ãƒ¼ã‚¹ã®é«˜é€Ÿãƒã‚§ãƒƒã‚¯
                return window.AppState.bookmarkedSet.has(String(guideId));
            },
            
            getAll: function() {
                // âœ… Set ã‹ã‚‰é…åˆ—ã«å¤‰æ›
                return Array.from(window.AppState.bookmarkedSet).map(id => parseInt(id) || id);
            },
            
            updateButtonStates: function() {
                document.querySelectorAll('.bookmark-btn').forEach(btn => {
                    const guideId = btn.getAttribute('data-guide-id');
                    const isBookmarked = this.isBookmarked(guideId);
                    
                    if (isBookmarked) {
                        btn.classList.remove('btn-outline-warning');
                        btn.classList.add('btn-warning');
                        btn.innerHTML = '<i class="bi bi-bookmark-fill"></i> <span class="ms-1">ä¿å­˜æ¸ˆã¿</span>';
                    } else {
                        btn.classList.remove('btn-warning');
                        btn.classList.add('btn-outline-warning');
                        btn.innerHTML = '<i class="bi bi-bookmark"></i> <span class="ms-1">ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</span>';
                    }
                });
            },
            
            showNotification: function(message, type = 'info') {
                if (typeof safeShowToast === 'function') {
                    safeShowToast(message, type);
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
                    const notification = document.createElement('div');
                    notification.className = `alert alert-${type === 'success' ? 'success' : 'info'} position-fixed`;
                    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
                    notification.innerHTML = `${message} <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>`;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentElement) notification.remove();
                    }, 3000);
                }
            }
        };
        
        // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã®é–¢æ•°ã‚¨ã‚¤ãƒªã‚¢ã‚¹
        function addToBookmarks(guideId) {
            return window.BookmarkManager.add(guideId);
        }

        // âœ… çµ±ä¸€ã•ã‚ŒãŸæ¯”è¼ƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
        window.ComparisonManager = {
            add: function(guideId) {
                console.log('ğŸ“Š Adding to comparison:', guideId);
                
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                
                // æ¯”è¼ƒãƒªã‚¹ãƒˆã®ä¸Šé™ãƒã‚§ãƒƒã‚¯
                if (comparisonGuides.length >= 3) {
                    this.showNotification('æ¯”è¼ƒãƒªã‚¹ãƒˆã¯æœ€å¤§3ä»¶ã¾ã§ã§ã™', 'warning');
                    return false;
                }
                
                if (!comparisonGuides.includes(id) && !comparisonGuides.includes(guideId)) {
                    comparisonGuides.push(id);
                    localStorage.setItem('comparisonGuides', JSON.stringify(comparisonGuides));
                    
                    this.updateButtonStates();
                    this.showNotification('æ¯”è¼ƒãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                    
                    console.log('âœ… Comparison added:', id, 'Total comparisons:', comparisonGuides.length);
                    return true;
                } else {
                    console.log('âš ï¸ Guide already in comparison:', guideId);
                    return false;
                }
            },
            
            remove: function(guideId) {
                console.log('ğŸ“Š Removing from comparison:', guideId);
                
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                
                const updatedComparison = comparisonGuides.filter(compareId => 
                    compareId !== id && compareId !== guideId
                );
                
                if (updatedComparison.length !== comparisonGuides.length) {
                    localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
                    
                    this.updateButtonStates();
                    this.showNotification('æ¯”è¼ƒãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
                    
                    console.log('âœ… Comparison removed:', id, 'Remaining comparisons:', updatedComparison.length);
                    return true;
                } else {
                    console.log('âš ï¸ Guide not in comparison:', guideId);
                    return false;
                }
            },
            
            toggle: function(guideId) {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                
                if (comparisonGuides.includes(id) || comparisonGuides.includes(guideId)) {
                    return this.remove(guideId);
                } else {
                    return this.add(guideId);
                }
            },
            
            isInComparison: function(guideId) {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                return comparisonGuides.includes(id) || comparisonGuides.includes(guideId);
            },
            
            getAll: function() {
                return JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            },
            
            updateButtonStates: function() {
                document.querySelectorAll('.compare-btn').forEach(btn => {
                    const guideId = btn.getAttribute('data-guide-id');
                    const isInComparison = this.isInComparison(guideId);
                    
                    if (isInComparison) {
                        btn.classList.remove('btn-outline-success');
                        btn.classList.add('btn-success');
                        btn.innerHTML = '<i class="bi bi-check2-square-fill"></i> <span class="ms-1">æ¯”è¼ƒä¸­</span>';
                    } else {
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-success');
                        btn.innerHTML = '<i class="bi bi-check2-square"></i> <span class="ms-1">æ¯”è¼ƒ</span>';
                    }
                });
            },
            
            showNotification: function(message, type = 'info') {
                if (typeof safeShowToast === 'function') {
                    safeShowToast(message, type);
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
                    const notification = document.createElement('div');
                    notification.className = `alert alert-${type === 'success' ? 'success' : (type === 'warning' ? 'warning' : 'info')} position-fixed`;
                    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
                    notification.innerHTML = `${message} <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>`;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentElement) notification.remove();
                    }, 3000);
                }
            }
        };
        
        // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã®é–¢æ•°ã‚¨ã‚¤ãƒªã‚¢ã‚¹
        function addToComparison(guideId) {
            return window.ComparisonManager.add(guideId);
        }

        // âœ… å…±æœ‰ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿å¾…æ©Ÿãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        window.waitForGuideData = async function(maxWaitTime = 10000) {
            console.log('â³ Waiting for guide data to be ready...');
            
            const startTime = Date.now();
            
            while (Date.now() - startTime < maxWaitTime) {
                // è¤‡æ•°ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
                const guides = window.AppState?.originalGuides || window.AppState?.guides || window.guidesData || [];
                
                if (guides && guides.length > 0) {
                    console.log('âœ… Guide data ready:', guides.length, 'guides loaded');
                    return guides;
                }
                
                // çŸ­ã„é–“éš”ã§å†ãƒã‚§ãƒƒã‚¯
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            console.warn('âš ï¸ Guide data not ready after', maxWaitTime, 'ms, proceeding with available data');
            return window.AppState?.originalGuides || window.AppState?.guides || window.guidesData || [];
        };

        // âœ… localStorageå½¢å¼çµ±ä¸€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
        window.migrateStorageFormats = function() {
            console.log('ğŸ”„ Starting localStorage migration...');
            
            try {
                // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
                const migrationKey = 'tomotrip_storage_migrated_v1';
                if (localStorage.getItem(migrationKey) === 'true') {
                    console.log('âœ… Storage already migrated, skipping');
                    return;
                }
                
                // ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const migrateBookmarks = () => {
                    const bookmarkKey = 'bookmarkedGuides';
                    const currentBookmarks = localStorage.getItem(bookmarkKey);
                    
                    if (currentBookmarks) {
                        try {
                            const parsed = JSON.parse(currentBookmarks);
                            
                            // IDé…åˆ—ã«æ­£è¦åŒ–ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã®å ´åˆï¼‰
                            const normalizedIds = parsed.map(item => {
                                if (typeof item === 'object' && item !== null) {
                                    return parseInt(item.id) || item.id;
                                }
                                return parseInt(item) || item;
                            }).filter(id => id !== null && id !== undefined);
                            
                            // é‡è¤‡é™¤å»
                            const uniqueIds = [...new Set(normalizedIds)];
                            
                            localStorage.setItem(bookmarkKey, JSON.stringify(uniqueIds));
                            console.log('âœ… Migrated bookmarks:', uniqueIds.length, 'items');
                        } catch (error) {
                            console.warn('âš ï¸ Bookmark migration error:', error);
                            localStorage.setItem(bookmarkKey, '[]');
                        }
                    } else {
                        localStorage.setItem(bookmarkKey, '[]');
                    }
                };
                
                // æ¯”è¼ƒãƒªã‚¹ãƒˆã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const migrateComparisons = () => {
                    const comparisonKey = 'comparisonGuides';
                    const currentComparisons = localStorage.getItem(comparisonKey);
                    
                    if (currentComparisons) {
                        try {
                            const parsed = JSON.parse(currentComparisons);
                            
                            // IDé…åˆ—ã«æ­£è¦åŒ–ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã®å ´åˆï¼‰
                            const normalizedIds = parsed.map(item => {
                                if (typeof item === 'object' && item !== null) {
                                    return parseInt(item.id) || item.id;
                                }
                                return parseInt(item) || item;
                            }).filter(id => id !== null && id !== undefined);
                            
                            // é‡è¤‡é™¤å» & 3ä»¶åˆ¶é™
                            const uniqueIds = [...new Set(normalizedIds)].slice(0, 3);
                            
                            localStorage.setItem(comparisonKey, JSON.stringify(uniqueIds));
                            console.log('âœ… Migrated comparisons:', uniqueIds.length, 'items');
                        } catch (error) {
                            console.warn('âš ï¸ Comparison migration error:', error);
                            localStorage.setItem(comparisonKey, '[]');
                        }
                    } else {
                        localStorage.setItem(comparisonKey, '[]');
                    }
                };
                
                // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
                migrateBookmarks();
                migrateComparisons();
                
                // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                localStorage.setItem(migrationKey, 'true');
                console.log('âœ… Storage migration completed successfully');
                
            } catch (error) {
                console.error('âŒ Storage migration failed:', error);
            }
        };

        // Filter functions moved to app-init.mjs to prevent conflicts

        // Reset function moved to app-init.mjs to prevent conflicts

        // Tourist Registration functions moved to app-init.mjs to prevent conflicts
        
        function goToStep1Modal() {
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step1Content').style.display = 'block';
            
            // Reset indicators
            document.getElementById('step1-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-secondary rounded-circle me-2';
        }
        
        function goToStep3Modal() {
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step3Content').style.display = 'block';
            
            // Update indicators
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-success rounded-circle me-2';
            document.getElementById('step3-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
        }
        
        function goToStep2FromStep3() {
            document.getElementById('step3Content').style.display = 'none';
            document.getElementById('step2Content').style.display = 'block';
            
            // Reset indicators
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
            document.getElementById('step3-indicator').querySelector('.badge').className = 'badge bg-secondary rounded-circle me-2';
        }
        
        function completeRegistrationModal() {
            alert('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            const modal = bootstrap.Modal.getInstance(document.getElementById('registrationModal'));
            modal.hide();
        }
        
        function removeFileModal() {
            document.getElementById('uploadPreviewModal').style.display = 'none';
            document.getElementById('fileInputModal').value = '';
            document.getElementById('completeBtnModal').disabled = true;
            document.getElementById('uploadSuccessModal').style.display = 'none';
        }

        // Price conversion function
        function getPriceFromRange(rangeValue) {
            const priceRanges = {
                'Â¥6,000~Â¥10,000': 'Â¥8,000',
                'Â¥10,000~Â¥15,000': 'Â¥12,500',
                'Â¥15,000~Â¥20,000': 'Â¥17,500',
                'Â¥20,000~Â¥30,000': 'Â¥25,000',
                'Â¥30,000~Â¥50,000': 'Â¥40,000',
                'Â¥50,000+': 'Â¥60,000'
            };
            return priceRanges[rangeValue] || '';
        }



        // Language switching functions
        function switchToJapanese() {
            console.log('ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªé¸æŠ - æ—¢ã«æ—¥æœ¬èªç‰ˆã§ã™');
            alert('æ—¢ã«æ—¥æœ¬èªç‰ˆã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™');
        }

        function switchToEnglish() {
            console.log('ğŸ‡ºğŸ‡¸ English selected - switching to English page');
            window.location.href = 'index-en.html';
        }

        // Login dropdown toggle
        function toggleLoginDropdown() {
            const dropdown = document.getElementById('customLoginDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('customLoginDropdown');
            const button = document.getElementById('loginDropdown');
            
            if (button && dropdown && !button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });



        // View guide detail with access control - redirect to detail page
        function viewGuideDetail(guideId) {
            console.log('Opening guide detail page for guide:', guideId);
            
            // Check if user is registered
            const touristData = localStorage.getItem('touristRegistrationData');
            console.log('Tourist registration status:', touristData ? 'REGISTERED' : 'NOT REGISTERED');
            
            if (!touristData) {
                // Show registration modal for unregistered users
                console.log('Showing registration modal for unregistered user');
                const registrationModal = new bootstrap.Modal(document.getElementById('registrationModal'));
                registrationModal.show();
                return;
            }

            // Store all guides data for the detail page
            const allGuides = loadAllGuides();
            localStorage.setItem('allGuides', JSON.stringify(allGuides));
            
            // Redirect to guide detail page
            console.log('Redirecting to guide detail page for registered user');
            window.location.href = `/guide-detail.html?id=${guideId}`;
        }

        // Show guide detail modal
        function showGuideDetailModal(guide) {
            console.log('ğŸ”§ Creating guide detail modal for:', guide.name);
            try {
                const detailModal = document.createElement('div');
                detailModal.className = 'modal fade';
                detailModal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.2);">
                        <div class="modal-header border-0" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 15px 15px 0 0;">
                            <h5 class="modal-title fw-bold">
                                <i class="bi bi-person-circle me-2"></i>Guide Details
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="${guide.image}" class="img-fluid rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                                    <div class="text-center">
                                        <span class="text-warning">â˜…</span>
                                        <span class="fw-bold">${guide.rating}</span>
                                    </div>
                                    <div class="fw-bold text-primary fs-4">Â¥${Number(guide?.price || 0).toLocaleString()}</div>
                                    <small class="text-muted">${getLocalizedText('perDay')}</small>
                                </div>
                                <div class="col-md-8">
                                    <h6 class="text-primary mb-3">Basic Information</h6>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Location:</strong></div>
                                        <div class="col-sm-8">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Specialty:</strong></div>
                                        <div class="col-sm-8">${guide.specialty}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Languages:</strong></div>
                                        <div class="col-sm-8">
                                            ${guide.languages.map(lang => {
                                                const langMap = {
                                                    'ja': 'æ—¥æœ¬èª', 'japanese': 'æ—¥æœ¬èª',
                                                    'en': 'è‹±èª', 'english': 'è‹±èª', 
                                                    'zh': 'ä¸­å›½èª', 'chinese': 'ä¸­å›½èª',
                                                    'ko': 'éŸ“å›½èª', 'korean': 'éŸ“å›½èª',
                                                    'es': 'ã‚¹ãƒšã‚¤ãƒ³èª', 'spanish': 'ã‚¹ãƒšã‚¤ãƒ³èª',
                                                    'fr': 'ãƒ•ãƒ©ãƒ³ã‚¹èª', 'french': 'ãƒ•ãƒ©ãƒ³ã‚¹èª',
                                                    'de': 'ãƒ‰ã‚¤ãƒ„èª', 'german': 'ãƒ‰ã‚¤ãƒ„èª',
                                                    'it': 'ã‚¤ã‚¿ãƒªã‚¢èª', 'italian': 'ã‚¤ã‚¿ãƒªã‚¢èª'
                                                };
                                                return langMap[lang.toLowerCase()] || lang;
                                            }).join(', ')}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-primary">Guide Introduction</h6>
                                        <p class="text-muted">${guide.description}</p>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-primary">Service Details</h6>
                                        <ul class="text-muted">
                                            <li>Professional guide service</li>
                                            <li>Safe local support</li>
                                            <li>Photography service</li>
                                            <li>Recommended spot guidance</li>
                                            <li>Cultural and historical explanations</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-success" onclick="bookGuide(${guide.id})">
                                <i class="bi bi-calendar-check me-2"></i>Book Now
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="contactGuide(${guide.id})">
                                <i class="bi bi-chat-dots me-2"></i>Message
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('ğŸ“± Appending modal to DOM...');
            document.body.appendChild(detailModal);
            
            console.log('ğŸ”§ Creating Bootstrap modal instance...');
            const modal = new bootstrap.Modal(detailModal);
            
            console.log('ğŸš€ Showing modal...');
            modal.show();
            
            console.log('âœ… Modal shown successfully');
            
            // Clean up modal after hiding
            detailModal.addEventListener('hidden.bs.modal', function() {
                console.log('ğŸ—‘ï¸ Cleaning up modal...');
                detailModal.remove();
            });
            
            } catch (error) {
                console.error('âŒ Error creating guide detail modal:', error);
                alert('Error showing guide details: ' + error.message);
            }
        }

        // Booking and contact functions
        window.bookGuide = function(guideId) {
            // Close the guide detail modal first
            const openModal = document.querySelector('.modal.show');
            if (openModal) {
                const modalInstance = bootstrap.Modal.getInstance(openModal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            }
            
            // Wait a moment for the modal to close, then open booking
            setTimeout(() => {
                showBookingModal(guideId);
            }, 300);
        }

        window.contactGuide = function(guideId) {
            // Close the guide detail modal first
            const openModal = document.querySelector('.modal.show');
            if (openModal) {
                const modalInstance = bootstrap.Modal.getInstance(openModal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            }
            
            // Wait a moment for the modal to close, then open chat
            setTimeout(() => {
                showChatModal(guideId);
            }, 300);
        }

        // Login functionality
        function showLoginModal(loginType) {
            return new Promise((resolve) => {
                try {
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                    document.getElementById('loginModal').setAttribute('data-login-type', loginType);
                    
                    // Update modal content based on login type
                    const badge = document.getElementById('loginTypeBadge');
                    if (loginType === 'tourist') {
                        badge.textContent = 'Tourist Login';
                        badge.className = 'badge bg-primary fs-6';
                    } else if (loginType === 'guide') {
                        badge.textContent = 'Guide Login';
                        badge.className = 'badge bg-success fs-6';
                    }
                    
                    resolve(true);
                } catch (error) {
                    const modalElement = document.getElementById('loginModal');
                    if (modalElement) {
                        modalElement.style.display = 'block';
                        modalElement.classList.add('show');
                        modalElement.style.backgroundColor = 'rgba(0,0,0,0.5)';
                    }
                    resolve(false);
                }
            });
        }

        // Registration choice modal is now handled by event-handlers.mjs

        // Tourist registration is now handled by event-handlers.mjs

        // All registration functionality is now handled by event-handlers.mjs
        
        // Guide registration is now handled by event-handlers.mjs - function removed to prevent conflicts

        // Setup dropdown listeners - REMOVED
        // All button handlers are now in button-setup.js to avoid conflicts
        function setupCustomDropdownListeners() {
            // Deprecated: All handlers moved to button-setup.js
            console.log('âœ… Dropdown listeners handled by button-setup.js');
        }

        // Get price from range selection
        function getPriceFromRange(rangeValue) {
            if (!rangeValue) return null;
            
            const rangeMap = {
                '6000-10000': 8000,
                '10000-15000': 12500,
                '15000-20000': 17500,
                '20000-25000': 22500,
                '25000-30000': 27500,
                '30000+': 35000
            };
            
            return rangeMap[rangeValue] || null;
        }

        // Update guide display with registered guides
        function updateGuideDisplay() {
            const registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
            
            // Combine default guides with registered guides
            currentGuides = [...registeredGuides];
            guideData = currentGuides;
            
            // Re-display guides
            displayGuides(currentGuides);
            
            console.log(`ğŸ“Š Updated guide display: ${registeredGuides.length} registered = ${currentGuides.length} total`);
        }

        // Global functions now handled by app-init.mjs to prevent conflicts

        // Emergency button setup for immediate functionality
        function setupEmergencyButtons() {
            console.log('ğŸš¨ Emergency button setup started');
            
            // Dashboard button
            const dashboardBtn = document.getElementById('dashboardBtn');
            if (dashboardBtn && !dashboardBtn.hasAttribute('data-emergency-setup')) {
                dashboardBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('ğŸª Dashboard clicked');
                    window.open('sponsor-dashboard.html', '_blank');
                });
                dashboardBtn.setAttribute('data-emergency-setup', 'true');
                console.log('âœ… Dashboard button setup');
            }
            
            // Login dropdown
            const loginDropdown = document.getElementById('loginDropdown');
            const customLoginDropdown = document.getElementById('customLoginDropdown');
            if (loginDropdown && customLoginDropdown && !loginDropdown.hasAttribute('data-emergency-setup')) {
                loginDropdown.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('ğŸ”‘ Login dropdown clicked');
                    const isVisible = customLoginDropdown.style.display === 'block';
                    customLoginDropdown.style.display = isVisible ? 'none' : 'block';
                });
                loginDropdown.setAttribute('data-emergency-setup', 'true');
                console.log('âœ… Login dropdown setup');
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (customLoginDropdown && loginDropdown && !loginDropdown.contains(e.target) && !customLoginDropdown.contains(e.target)) {
                    customLoginDropdown.style.display = 'none';
                }
            });
            
            console.log('âœ… Emergency button setup completed');
        }
        
        // Run emergency setup immediately and after DOM loads
        setupEmergencyButtons();
        
        // âœ… ä¿®æ­£: DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’åˆ†é›¢ã—ã¦æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±º
        // Initialize page - manual event listeners (app-init.mjs handles main initialization)
        document.addEventListener('DOMContentLoaded', function() {
            setupEmergencyButtons(); // Run again after DOM loads
            // Event listeners for search and filter functionality
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) {
                searchBtn.addEventListener('click', async function() {
                    // âœ… ä¿®æ­£æ¸ˆã¿ã®executeSearchã‚’ä½¿ç”¨
                    if (window.executeSearch) {
                        await window.executeSearch();
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§executeSearchã‚’å–å¾—
                        try {
                            const { executeSearch } = await import('./assets/js/search/search-filter.mjs');
                            window.executeSearch = executeSearch;
                            await executeSearch();
                        } catch (error) {
                            console.error('âŒ Search function import failed:', error);
                            alert('æ¤œç´¢æ©Ÿèƒ½ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        }
                    }
                });
            }
            
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (window.resetFilters) {
                        window.resetFilters();
                    } else {
                        location.reload();
                    }
                });
            }
            
            // Tourist registration modal event listeners
            const sendCodeBtn = document.getElementById('sendCodeBtnModal');
            if (sendCodeBtn) {
                sendCodeBtn.addEventListener('click', function() {
                    document.getElementById('sendCodeSectionModal').style.display = 'none';
                    document.getElementById('verifyCodeSectionModal').style.display = 'block';
                });
            }
            
            const verifyCodeBtn = document.getElementById('verifyCodeBtnModal');
            if (verifyCodeBtn) {
                verifyCodeBtn.addEventListener('click', function() {
                    const code = document.getElementById('verificationCodeModal').value;
                    if (code === '123456') {
                        document.getElementById('verifyCodeSectionModal').style.display = 'none';
                        document.getElementById('verificationSuccessModal').style.display = 'block';
                        document.getElementById('step2NextBtnModal').disabled = false;
                    } else {
                        alert('èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                    }
                });
            }
            
            const fileInput = document.getElementById('fileInputModal');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('fileNameModal').textContent = file.name;
                        document.getElementById('uploadPreviewModal').style.display = 'block';
                        document.getElementById('uploadSuccessModal').style.display = 'block';
                        document.getElementById('completeBtnModal').disabled = false;
                        
                        // Show preview for images
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                document.getElementById('previewImageModal').src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                });
            }
            
            // Add change event listeners for filters to enable real-time filtering
            const locationFilter = document.getElementById('locationFilter');
            const languageFilter = document.getElementById('languageFilter');
            const priceFilter = document.getElementById('priceFilter');
            const keywordInput = document.getElementById('keywordInput');
            
            // âœ… executeSearchã‚’ä½¿ç”¨ã™ã‚‹çµ±ä¸€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢æ•°
            window.filterGuides = async function() {
                console.log('ğŸ¯ filterGuides function executing via executeSearch...');
                
                try {
                    // executeSearchãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
                    if (window.executeSearch && typeof window.executeSearch === 'function') {
                        await window.executeSearch();
                        return;
                    }
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å¤ã„ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆexecuteSearchãŒåˆ©ç”¨ã§ããªã„å ´åˆã®ã¿ï¼‰
                    console.warn('âš ï¸ executeSearch not available, using fallback filter');
                    
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å€¤ã‚’å–å¾—
                    const locationFilter = document.getElementById('locationFilter')?.value || '';
                    const languageFilter = document.getElementById('languageFilter')?.value || '';
                    const priceFilter = document.getElementById('priceFilter')?.value || '';
                    const keywordInput = document.getElementById('keywordInput')?.value?.toLowerCase() || '';
                    
                    console.log('ğŸ” Filter values:', { locationFilter, languageFilter, priceFilter, keywordInput });
                    
                    // ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    const allGuides = window.AppState?.originalGuides || window.AppState?.guides || [];
                    
                    if (allGuides.length === 0) {
                        console.warn('âš ï¸ No guides available for filtering');
                        return;
                    }
                    
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œï¼ˆé«˜é€ŸåŒ–ï¼‰
                    let filteredGuides = allGuides.filter(guide => {
                        // å ´æ‰€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                        if (locationFilter && !guide.location?.includes(locationFilter) && !guide.city?.includes(locationFilter)) {
                            return false;
                        }
                        
                        // è¨€èªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                        if (languageFilter && !guide.languages?.includes(languageFilter)) {
                            return false;
                        }
                        
                        // ä¾¡æ ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                        if (priceFilter) {
                            const price = parseInt(guide.price || guide.sessionRate || 0);
                            const [minPrice, maxPrice] = priceFilter.split('-').map(p => parseInt(p));
                            if (price < minPrice || (maxPrice && price > maxPrice)) {
                                return false;
                            }
                        }
                        
                        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
                        if (keywordInput) {
                            const searchText = `${guide.name} ${guide.location} ${guide.specialties || ''} ${guide.introduction || ''}`.toLowerCase();
                            if (!searchText.includes(keywordInput)) {
                                return false;
                            }
                        }
                        
                        return true;
                    });
                    
                    console.log('âœ… Filtering complete:', filteredGuides.length, 'guides matched');
                    
                    // AppStateã‚’æ›´æ–°
                    if (window.AppState) {
                        window.AppState.filteredGuides = filteredGuides;
                        window.AppState.isFiltered = true;
                    }
                    
                    // çµæœã‚’è¡¨ç¤º
                    if (window.renderGuideCards) {
                        window.renderGuideCards(filteredGuides);
                    } else {
                        console.error('âŒ renderGuideCards function not available');
                    }
                    
                } catch (error) {
                    console.error('âŒ filterGuides error:', error);
                }
            };
            
            // ãƒªã‚»ãƒƒãƒˆé–¢æ•°ã‚‚å®Ÿè£…
            window.resetFilters = function() {
                console.log('ğŸ”„ Reset filters function executing...');
                
                try {
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¦ç´ ã‚’ã‚¯ãƒªã‚¢
                    const locationFilter = document.getElementById('locationFilter');
                    const languageFilter = document.getElementById('languageFilter');
                    const priceFilter = document.getElementById('priceFilter');
                    const keywordInput = document.getElementById('keywordInput');
                    
                    if (locationFilter) locationFilter.value = '';
                    if (languageFilter) languageFilter.value = '';
                    if (priceFilter) priceFilter.value = '';
                    if (keywordInput) keywordInput.value = '';
                    
                    // AppStateã‚’ãƒªã‚»ãƒƒãƒˆ
                    if (window.AppState) {
                        window.AppState.isFiltered = false;
                        window.AppState.isFiltering = false;
                        window.AppState.filteredGuides = null;
                        
                        // å…ƒã®ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¾©å…ƒ
                        const originalGuides = window.AppState.originalGuides || [];
                        window.AppState.guides = [...originalGuides];
                        window.AppState.currentPage = 1;
                        
                        console.log(`âœ… Reset complete - restoring ${originalGuides.length} guides`);
                        
                        // ã™ã¹ã¦ã®ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º
                        if (window.renderGuideCards) {
                            window.renderGuideCards(originalGuides);
                        }
                        
                        if (window.updateGuideCounters) {
                            window.updateGuideCounters(originalGuides.length, originalGuides.length);
                        }
                    }
                    
                    console.log('âœ… Filters reset successfully');
                    
                } catch (error) {
                    console.error('âŒ resetFilters error:', error);
                }
            };

            // âœ… executeSearchã‚’ä½¿ç”¨ã™ã‚‹å®‰å…¨ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢æ•°
            async function safeFilterGuides() {
                if (window.executeSearch && typeof window.executeSearch === 'function') {
                    await window.executeSearch();
                } else if (window.filterGuides && typeof window.filterGuides === 'function') {
                    await window.filterGuides();
                } else {
                    console.warn('âš ï¸ No filter function ready, retrying in 100ms...');
                    setTimeout(safeFilterGuides, 100);
                }
            }
            
            if (locationFilter) locationFilter.addEventListener('change', safeFilterGuides);
            if (languageFilter) languageFilter.addEventListener('change', safeFilterGuides);
            if (priceFilter) priceFilter.addEventListener('change', safeFilterGuides);
            if (keywordInput) keywordInput.addEventListener('input', safeFilterGuides);
            
            // Registration button event - show choice modal (handled by app-init.mjs)
            // const regBtn = document.getElementById('registerBtn');
            // if (regBtn) {
            //     regBtn.addEventListener('click', function(e) {
            //         e.preventDefault();
            //         console.log('Registration button clicked!');
            //         showRegistrationChoice();
            //     });
            // }
            
            // Initialize chat listeners
            // initializeChatListeners(); // Handled by app-init.mjs
            
            // Registration form submission
            const registerSubmitBtn = document.getElementById('registerSubmitBtn');
            if (registerSubmitBtn) {
                registerSubmitBtn.addEventListener('click', function() {
                const form = document.getElementById('registrationForm');
                const formData = {
                    realName: {
                        first: document.getElementById('realFirstName').value.trim(),
                        last: document.getElementById('realLastName').value.trim()
                    },
                    email: document.getElementById('email').value.trim(),
                    country: document.getElementById('country').value,
                    phone: document.getElementById('phone').value.trim(),
                    visitPurpose: document.getElementById('visitPurpose').value,
                    visitDuration: document.getElementById('visitDuration').value,
                    preferredLanguage: document.getElementById('preferredLanguage').value,
                    interests: document.getElementById('interests').value.trim(),
                    agreeTerms: document.getElementById('agreeTerms').checked,
                    receiveUpdates: document.getElementById('receiveUpdates').checked
                };

                // Validate required fields
                if (!formData.realName.first || !formData.realName.last || !formData.email || !formData.country) {
                    alert('Please fill in all required fields (marked with *)');
                    return;
                }

                if (!formData.agreeTerms) {
                    alert('Please agree to the Terms of Service and Privacy Policy');
                    return;
                }

                // Save tourist data
                try {
                    const touristData = {
                        ...formData,
                        registrationDate: new Date().toISOString(),
                        id: Date.now()
                    };
                    
                    localStorage.setItem('touristRegistrationData', JSON.stringify(touristData));
                    
                    // Close modal
                    const registrationModal = bootstrap.Modal.getInstance(document.getElementById('registrationModal'));
                    registrationModal.hide();
                    
                    // Show success message
                    setTimeout(() => {
                        alert('Registration completed successfully!\n\nYou can now view guide details and book tours.');
                    }, 500);
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    alert('An error occurred during registration. Please try again.');
                }
                });
            }

            // Login form submission
            const loginSubmitBtn = document.getElementById('loginSubmitBtn');
            if (loginSubmitBtn) {
                loginSubmitBtn.addEventListener('click', function() {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (!email || !password) {
                    alert('Please enter both email and password.');
                    return;
                }
                
                // For development - simulate successful login
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                
                setTimeout(() => {
                    alert('Login successful!\n\nNote: Login functionality is currently under development. Actual authentication will be implemented soon.');
                }, 500);
                });
            }

            // Contact form submission
            const contactSubmitBtn = document.getElementById('contactSubmitBtn');
            if (contactSubmitBtn) {
                contactSubmitBtn.addEventListener('click', function() {
                const name = document.getElementById('contactName').value.trim();
                const email = document.getElementById('contactEmail').value.trim();
                const subject = document.getElementById('contactSubject').value;
                const message = document.getElementById('contactMessage').value.trim();
                
                if (!name || !email || !subject || !message) {
                    alert('Please fill in all fields.');
                    return;
                }
                
                // Close modal
                const contactModal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
                contactModal.hide();
                
                setTimeout(() => {
                    alert('Thank you for your message!\n\nWe will respond to your inquiry within 24 hours.');
                }, 500);
                });
            }

            // Guide Registration Functions
            let isGuidePhoneVerified = false;

            // Profile photo preview for guide
            const guideProfilePhoto = document.getElementById('guideProfilePhoto');
            if (guideProfilePhoto) {
                guideProfilePhoto.addEventListener('change', function(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('guideProfilePreview');
                const placeholder = document.getElementById('guidePhotoPlaceholder');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        placeholder.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                }
                });
            }

            // Guide phone verification
            const guideSendVerificationBtn = document.getElementById('guideSendVerificationBtn');
            if (guideSendVerificationBtn) {
                guideSendVerificationBtn.addEventListener('click', function() {
                const phone = document.getElementById('guidePhoneLogin').value;
                if (phone.match(/^[0-9+\-()]+$/)) {
                    document.getElementById('guideVerificationCodeSection').style.display = 'block';
                    this.disabled = true;
                    this.textContent = 'Sent';
                    
                    // Simulate SMS sending
                    alert('Verification code sent! (Demo: enter "123456")');
                } else {
                    alert('Please enter a valid phone number');
                }
                });
            }

            const guideVerifyCodeBtn = document.getElementById('guideVerifyCodeBtn');
            if (guideVerifyCodeBtn) {
                guideVerifyCodeBtn.addEventListener('click', function() {
                const code = document.getElementById('guideVerificationCode').value;
                if (code === '123456') {
                    isGuidePhoneVerified = true;
                    this.textContent = 'Verified';
                    this.disabled = true;
                    this.classList.remove('btn-success');
                    this.classList.add('btn-outline-success');
                    document.getElementById('guideVerificationCode').disabled = true;
                    alert('Phone verification completed!');
                } else {
                    alert('Invalid verification code');
                }
                });
            }

            // Guide price handling
            const guidePriceRange = document.getElementById('guidePriceRange');
            if (guidePriceRange) {
                guidePriceRange.addEventListener('change', function() {
                const priceInput = document.getElementById('guidePriceInput');
                if (this.value) {
                    priceInput.value = '';
                    priceInput.disabled = true;
                } else {
                    priceInput.disabled = false;
                }
                });
            }

            const guidePriceInput = document.getElementById('guidePriceInput');
            if (guidePriceInput) {
                guidePriceInput.addEventListener('input', function() {
                const priceRange = document.getElementById('guidePriceRange');
                if (this.value) {
                    priceRange.value = '';
                    priceRange.disabled = true;
                } else {
                    priceRange.disabled = false;
                }
                });
            }

            // Detailed guide registration form submission
            const detailedGuideForm = document.getElementById('detailedGuideForm');
            if (detailedGuideForm) {
                detailedGuideForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        guideName: document.getElementById('detailedGuideName').value.trim(),
                        email: document.getElementById('detailedGuideEmail').value.trim(),
                        phone: document.getElementById('detailedGuidePhone').value.trim(),
                        gender: document.getElementById('detailedGuideGender').value,
                        age: parseInt(document.getElementById('detailedGuideAge').value),
                        experience: document.getElementById('detailedGuideExperience').value,
                        languages: Array.from(document.getElementById('detailedGuideLanguages').selectedOptions).map(option => option.value),
                        introduction: document.getElementById('detailedGuideIntroduction').value.trim(),
                        specialties: document.getElementById('detailedGuideSpecialties').value.trim(),
                        hourlyRate: parseFloat(document.getElementById('detailedGuideHourlyRate').value),
                        availability: document.getElementById('detailedGuideAvailability').value,
                        agreeTerms: document.getElementById('detailedAgreeTerms').checked
                    };
                    
                    console.log('Detailed guide registration:', formData);
                    
                    // Basic validation
                    if (!formData.agreeTerms) {
                        alert('åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    if (formData.languages.length === 0) {
                        alert('å¯¾å¿œè¨€èªã‚’æœ€ä½1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    // Simulate API call - replace with actual endpoint
                    alert(`ã‚¬ã‚¤ãƒ‰ç™»éŒ²ç”³è«‹ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚\nç”³è«‹è€…: ${formData.guideName}\nå¯¾å¿œè¨€èª: ${formData.languages.join(', ')}\nå¯©æŸ»å¾Œã€ãƒ¡ãƒ¼ãƒ«ã§ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚`);
                    
                    // Hide form after successful submission
                    document.getElementById('detailedGuideRegistrationForm').style.display = 'none';
                    
                    // Reset form
                    detailedGuideForm.reset();
                });
            }

            // Guide registration form submission (updated for new modal)
            const guideRegistrationSubmitBtn = document.getElementById('guideRegistrationSubmitBtn');
            if (guideRegistrationSubmitBtn) {
                guideRegistrationSubmitBtn.addEventListener('click', function() {
                    console.log('ğŸ¯ Guide registration form submitted');
                    
                    // Validate required fields
                    const guideName = document.getElementById('guideName').value.trim();
                    const guideEmail = document.getElementById('guideEmail').value.trim();
                    const guidePhone = document.getElementById('guidePhoneReg').value.trim();
                    const guideLocation = document.getElementById('guideLocation').value;
                    const guidePrice = document.getElementById('guidePrice').value;
                    const guideDescription = document.getElementById('guideDescription').value.trim();
                    
                    // Get selected languages
                    const selectedLanguages = [];
                    document.querySelectorAll('#guideRegistrationModal input[type="checkbox"]:checked').forEach(checkbox => {
                        selectedLanguages.push(checkbox.value);
                    });
                    
                    // Validation
                    if (!guideName || !guideEmail || !guidePhone || !guideLocation || !guidePrice || !guideDescription) {
                        alert('ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    if (selectedLanguages.length === 0) {
                        alert('å°‘ãªãã¨ã‚‚1ã¤ã®å¯¾å¿œè¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    const formData = {
                        name: guideName,
                        email: guideEmail,
                        phone: guidePhone,
                        location: guideLocation,
                        languages: selectedLanguages,
                        price: parseInt(guidePrice),
                        description: guideDescription
                    };

                    // Save guide data
                    try {
                        const guideData = {
                            ...formData,
                            id: Date.now(),
                            registrationDate: new Date().toISOString(),
                            type: 'guide',
                            rating: 4.5 + (Math.random() * 0.5), // Random rating between 4.5-5.0
                            image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=300&h=300&fit=crop&crop=face"
                        };

                        // Get existing registered guides
                        let registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
                        registeredGuides.push(guideData);
                        localStorage.setItem('registeredGuides', JSON.stringify(registeredGuides));

                        console.log('âœ… Guide registered successfully:', guideData);

                        // Update guide data for display
                        try {
                            if (typeof updateGuideDisplay === 'function') {
                                updateGuideDisplay();
                            }
                        } catch (error) {
                            console.error('Error updating guide display after registration:', error);
                            // Continue anyway as the registration was successful
                        }

                        // Close modal
                        const guideModal = bootstrap.Modal.getInstance(document.getElementById('guideRegistrationModal'));
                        if (guideModal) {
                            guideModal.hide();
                        }

                        // Reset form
                        document.getElementById('guideRegistrationForm').reset();

                        // Show success message
                        setTimeout(() => {
                            alert('ã‚¬ã‚¤ãƒ‰ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nç™»éŒ²å†…å®¹ã¯24æ™‚é–“ä»¥å†…ã«å¯©æŸ»ã•ã‚Œã€æ‰¿èªå¾Œã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã™ã€‚');
                        }, 500);

                    } catch (error) {
                        console.error('Guide registration error:', error);
                        alert('ç™»éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    }
                });
            }

            // Setup dropdown listeners
            setupCustomDropdownListeners();
            
            document.getElementById('prevPageBtn').addEventListener('click', () => {
                if (window.AppState && window.AppState.currentPage > 1) {
                    window.AppState.currentPage -= 1;
                    if (window.renderGuideCards) {
                        window.renderGuideCards(window.AppState.guides);
                    }
                }
            });
            
            document.getElementById('nextPageBtn').addEventListener('click', () => {
                if (window.AppState && window.AppState.guides) {
                    const totalPages = Math.ceil(window.AppState.guides.length / 12);
                    if (window.AppState.currentPage < totalPages) {
                        window.AppState.currentPage += 1;
                        if (window.renderGuideCards) {
                            window.renderGuideCards(window.AppState.guides);
                        }
                    }
                }
            });

            console.log('âœ… TomoTrip English Version Loaded Successfully - All Features Active');
        }); // âœ… DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼çµ‚äº†

        // Sponsor Registration and Login Functions
        function handleSponsorRegistration() {
            console.log('ğŸª Sponsor registration clicked');
            try {
                // Direct navigation to sponsor registration page
                window.location.href = './sponsor-registration.html';
            } catch (error) {
                console.error('âŒ Sponsor registration navigation error:', error);
                // Fallback to direct URL
                window.location.href = '/sponsor-registration.html';
            }
        }

        function handleSponsorLogin() {
            console.log('Sponsor login clicked');
            showSponsorLoginModal();
        }

        // Show sponsor login modal
        function showSponsorLoginModal() {
            const modalHtml = `
                <div class="modal fade" id="sponsorLoginModal" tabindex="-1" aria-labelledby="sponsorLoginModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border-radius: 15px 15px 0 0;">
                                <h5 class="modal-title fw-bold" id="sponsorLoginModalLabel">
                                    <i class="bi bi-shop me-2"></i>Store Login
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="sponsorLoginForm">
                                    <div class="mb-3">
                                        <label for="sponsorStoreName" class="form-label fw-bold">
                                            <i class="bi bi-shop me-2"></i>Store Name
                                        </label>
                                        <input type="text" class="form-control" id="sponsorStoreName" placeholder="Enter your store name" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorEmail" class="form-label fw-bold">
                                            <i class="bi bi-envelope me-2"></i>Email Address
                                        </label>
                                        <input type="email" class="form-control" id="sponsorEmail" placeholder="Store contact email" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorPhone" class="form-label fw-bold">
                                            <i class="bi bi-telephone me-2"></i>Phone Number
                                        </label>
                                        <input type="tel" class="form-control" id="sponsorPhone" placeholder="Store phone number (e.g., 03-1234-5678)" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorPassword" class="form-label fw-bold">
                                            <i class="bi bi-lock me-2"></i>Password
                                        </label>
                                        <input type="password" class="form-control" id="sponsorPassword" placeholder="Enter management password" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberSponsor">
                                        <label class="form-check-label" for="rememberSponsor">
                                            Remember login status
                                        </label>
                                    </div>
                                </form>
                                <div class="alert alert-info" style="border-radius: 10px;">
                                    <small><i class="bi bi-info-circle me-2"></i>First time using as a sponsor store? Please register from "Store Registration".</small>
                                </div>
                            </div>
                            <div class="modal-footer border-0 p-4 pt-0">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-primary" onclick="processSponsorLogin()" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #4ecdc4, #44a08d); border: none;">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>Login
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('sponsorLoginModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('sponsorLoginModal'));
            modal.show();
            
            // Clean up when modal is hidden
            document.getElementById('sponsorLoginModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // Process sponsor login
        function processSponsorLogin() {
            const storeName = document.getElementById('sponsorStoreName').value.trim();
            const email = document.getElementById('sponsorEmail').value.trim();
            const phone = document.getElementById('sponsorPhone').value.trim();
            const password = document.getElementById('sponsorPassword').value.trim();
            
            if (!storeName || !email || !phone || !password) {
                alert('Please fill in all fields.');
                return;
            }

            // Check if sponsor exists in registered sponsors
            const registeredSponsors = JSON.parse(localStorage.getItem('registeredSponsors') || '[]');
            const sponsor = registeredSponsors.find(s => 
                s.storeName === storeName && 
                s.email === email && 
                s.phone === phone
            );

            if (!sponsor) {
                alert('Store information not found. Please check your registration details.');
                return;
            }
            
            // Store sponsor session for management access
            sessionStorage.setItem('currentSponsor', JSON.stringify({
                id: sponsor.id,
                storeName: storeName,
                email: email,
                loginTime: new Date().toISOString()
            }));
            
            console.log('Sponsor login successful:', storeName);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('sponsorLoginModal'));
            modal.hide();
            
            // Show success and redirect
            setTimeout(() => {
                const successModal = document.createElement('div');
                successModal.className = 'modal fade';
                successModal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                                <h5 class="modal-title fw-bold">âœ… Store Login Successful</h5>
                            </div>
                            <div class="modal-body p-4 text-center">
                                <div class="mb-4">
                                    <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                                </div>
                                <h6 class="fw-bold mb-3">Redirecting to Store Management Dashboard</h6>
                                <p class="text-muted mb-0">Store Name: ${storeName}</p>
                                <p class="text-muted mb-0">Email: ${email}</p>
                                <div class="alert alert-success mt-3" style="border-radius: 10px;">
                                    <small><i class="bi bi-check-circle me-2"></i>You can edit and manage your store information.</small>
                                </div>
                            </div>
                            <div class="modal-footer border-0 p-4 pt-0">
                                <button type="button" class="btn btn-success w-100" onclick="redirectToSponsorDashboard()" style="border-radius: 25px; padding: 12px;">
                                    Go to Management Dashboard
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(successModal);
                const modal = new bootstrap.Modal(successModal);
                modal.show();
                
                // Clean up
                successModal.addEventListener('hidden.bs.modal', function() {
                    successModal.remove();
                });
            }, 500);
        }

        // Redirect to sponsor dashboard
        function redirectToSponsorDashboard() {
            const storeName = document.getElementById('sponsorStoreName').value.trim();
            const email = document.getElementById('sponsorEmail').value.trim();
            
            // Find the sponsor's ID for editing
            const registeredSponsors = JSON.parse(localStorage.getItem('registeredSponsors') || '[]');
            const sponsor = registeredSponsors.find(s => s.storeName === storeName && s.email === email);
            
            if (sponsor) {
                console.log('Redirecting to sponsor edit page for:', sponsor.storeName);
                window.location.href = `sponsor-edit.html?id=${sponsor.id}`;
            } else {
                console.error('Sponsor not found for redirect');
                alert('Error: Store information not found for redirection.');
            }
        }

        // Chat functionality (English version)
        let currentChatGuide = null;

        function showChatModal(guideId) {
            console.log('Guide ID: ' + guideId + ' message feature is under development.');
            
            // Find guide data
            const guide = currentGuides.find(g => g.id == guideId);
            if (!guide) {
                console.error('Guide not found for chat:', guideId);
                return;
            }

            currentChatGuide = guide;
            
            // Update modal with guide info
            document.getElementById('chatGuideName').textContent = guide.name;
            document.getElementById('chatGuideImage').src = guide.image;
            
            // Load chat history
            loadChatHistory(guideId);
            
            // Show modal
            const chatModal = new bootstrap.Modal(document.getElementById('chatModal'));
            chatModal.show();
            
            // Show development notice
            setTimeout(() => {
                addSystemMessage('Chat functionality will be fully implemented soon.');
            }, 500);
            
            console.log('Chat modal opened for guide:', guide.name);
        }

        function loadChatHistory(guideId) {
            const chatMessages = document.getElementById('chatMessages');
            const chatKey = `chat_${guideId}`;
            const savedMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            // Clear current messages
            chatMessages.innerHTML = '';
            
            // Display saved messages
            savedMessages.forEach(message => {
                displayMessage(message.text, message.sender, message.timestamp, false);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('chatMessageInput');
            const messageText = messageInput.value.trim();
            
            if (!messageText || !currentChatGuide) return;
            
            // Display user message
            const timestamp = new Date();
            displayMessage(messageText, 'user', timestamp);
            
            // Save message
            saveChatMessage(currentChatGuide.id, messageText, 'user', timestamp);
            
            // Clear input
            messageInput.value = '';
            
            // Simulate guide response (for demonstration)
            setTimeout(() => {
                const responses = [
                    'Thank you! I\'m happy to help you.',
                    'I\'ll answer your questions. Feel free to ask for details.',
                    'I\'ll suggest plans that match your preferences.',
                    'I\'ll support you with your travel planning.'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                const responseTime = new Date();
                displayMessage(response, 'guide', responseTime);
                saveChatMessage(currentChatGuide.id, response, 'guide', responseTime);
            }, 1000 + Math.random() * 2000);
        }

        function displayMessage(text, sender, timestamp, saveMessage = true) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            const isUser = sender === 'user';
            
            messageDiv.className = `mb-3 d-flex ${isUser ? 'justify-content-end' : 'justify-content-start'}`;
            
            const timeStr = timestamp.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="max-width-70 ${isUser ? 'text-end' : 'text-start'}">
                    <div class="p-3 rounded-3 ${isUser ? 'bg-primary text-white ms-5' : 'bg-white border me-5'}" 
                         style="border-radius: ${isUser ? '20px 20px 5px 20px' : '20px 20px 20px 5px'} !important;">
                        <p class="mb-1">${text}</p>
                        <small class="opacity-75">${timeStr}</small>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addSystemMessage(text) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = 'mb-3 text-center';
            messageDiv.innerHTML = `
                <div class="badge bg-secondary p-2">
                    <i class="bi bi-info-circle me-1"></i>${text}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function saveChatMessage(guideId, text, sender, timestamp) {
            const chatKey = `chat_${guideId}`;
            const savedMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            savedMessages.push({
                text: text,
                sender: sender,
                timestamp: timestamp
            });
            
            // Keep only last 100 messages
            if (savedMessages.length > 100) {
                savedMessages.splice(0, savedMessages.length - 100);
            }
            
            localStorage.setItem(chatKey, JSON.stringify(savedMessages));
        }

        // Booking functionality (English version)
        let currentBookingGuide = null;

        function showBookingModal(guideId) {
            console.log('Starting booking process: Guide ID ' + guideId);
            
            // Find guide data
            const guide = currentGuides.find(g => g.id == guideId);
            if (!guide) {
                console.error('Guide not found for booking:', guideId);
                return;
            }

            currentBookingGuide = guide;
            
            // Update modal with guide info
            document.getElementById('bookingGuideName').textContent = guide.name;
            document.getElementById('bookingGuideImage').src = guide.image;
            document.getElementById('bookingGuidePrice').textContent = guide.price;
            
            // Reset form
            document.getElementById('bookingForm').reset();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;
            
            updateBookingSummary();
            
            // Show modal
            const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
            bookingModal.show();
            
            console.log('Booking modal opened for guide:', guide.name);
        }

        function updateBookingSummary() {
            if (!currentBookingGuide) return;
            
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const duration = document.getElementById('bookingDuration').value;
            const participants = document.getElementById('bookingParticipants').value;
            
            const summary = document.getElementById('bookingSummary');
            const totalElement = document.getElementById('bookingTotal');
            
            console.log('Booking calculation debug:', {
                guide: currentBookingGuide.name,
                price: currentBookingGuide.price,
                priceType: typeof currentBookingGuide.price,
                date, time, duration, participants
            });
            
            if (date && time && duration && participants) {
                // Extract price - handle multiple formats
                let basePrice = 5000; // default fallback
                
                if (currentBookingGuide.price) {
                    if (typeof currentBookingGuide.price === 'string') {
                        // Handle string formats like "Â¥7000/æ™‚é–“" or "7000"
                        const priceMatch = currentBookingGuide.price.match(/\d+/);
                        if (priceMatch) {
                            basePrice = parseInt(priceMatch[0]);
                        }
                    } else if (typeof currentBookingGuide.price === 'number') {
                        basePrice = currentBookingGuide.price;
                    }
                }
                
                console.log('Extracted base price:', basePrice);
                
                const durationMultiplier = duration === '2' ? 1.5 : duration === '4' ? 2.5 : duration === '8' ? 4 : 1;
                const total = Math.round(basePrice * durationMultiplier * parseInt(participants));
                
                summary.innerHTML = `
                    <div class="mb-2"><strong>Guide:</strong> ${currentBookingGuide.name}</div>
                    <div class="mb-2"><strong>Date & Time:</strong> ${date} ${time}</div>
                    <div class="mb-2"><strong>Duration:</strong> ${duration} hours</div>
                    <div class="mb-2"><strong>Participants:</strong> ${participants} people</div>
                    <div class="mb-2"><strong>Base Rate:</strong> ${currentBookingGuide.price}/hour</div>
                `;
                totalElement.textContent = `Â¥${Number(total || 0).toLocaleString()}`;
            } else {
                summary.innerHTML = '<p class="text-muted">Please fill in the details</p>';
                totalElement.textContent = 'Â¥0';
            }
        }

        function submitBooking() {
            const form = document.getElementById('bookingForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Create booking object
            const booking = {
                id: Date.now(),
                guideId: currentBookingGuide.id,
                guideName: currentBookingGuide.name,
                guideImage: currentBookingGuide.image,
                guideRate: currentBookingGuide.price,
                date: formData.get('date'),
                time: formData.get('time'),
                duration: formData.get('duration'),
                participants: formData.get('participants'),
                specialRequests: formData.get('specialRequests'),
                totalPrice: document.getElementById('bookingTotal').textContent,
                status: 'pending',
                bookingDate: new Date().toISOString()
            };
            
            // Save as temporary booking data for payment with language info
            booking.language = 'en'; // Mark as English booking
            localStorage.setItem('tempBookingData', JSON.stringify(booking));
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
            modal.hide();
            
            // Redirect to payment page with language parameter
            window.location.href = 'payment.html?lang=en';
        }

        function saveBooking(booking) {
            const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
            bookings.push(booking);
            localStorage.setItem('userBookings', JSON.stringify(bookings));
        }

        function showBookingConfirmation(booking) {
            // Show toast notification
            const toastContainer = document.querySelector('.toast-container') || (() => {
                const container = document.createElement('div');
                container.className = 'toast-container position-fixed top-0 end-0 p-3';
                document.body.appendChild(container);
                return container;
            })();
            
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerHTML = `
                <div class="toast-header bg-success text-white">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <strong class="me-auto">Booking Confirmed</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    Booking #${booking.id} has been confirmed!
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove toast after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Initialize chat and booking listeners - called from main DOMContentLoaded
        function initializeChatListeners() {
            const sendBtn = document.getElementById('sendMessageBtn');
            const messageInput = document.getElementById('chatMessageInput');
            
            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }
            
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }

            // Booking form event listeners
            const bookingForm = document.getElementById('bookingForm');
            if (bookingForm) {
                const formInputs = bookingForm.querySelectorAll('input, select');
                formInputs.forEach(input => {
                    input.addEventListener('change', updateBookingSummary);
                });
            }

            const submitBookingBtn = document.getElementById('submitBookingBtn');
            if (submitBookingBtn) {
                submitBookingBtn.addEventListener('click', submitBooking);
            }

            // Management Center Button Event Listeners are handled in button-setup.js
            // to avoid duplicated bindings and maintain consistency

            // Initialize on page load
            updateBookmarkButtons();
            updateComparisonButtons();
        }
    </script>

    <!-- Chat Modal -->
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true" style="z-index: 2000;">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); height: 600px;">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #17a2b8, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="chatModalLabel">
                        <i class="bi bi-chat-dots me-2"></i>Chat with Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0 d-flex flex-column" style="height: 500px;">
                    <!-- Guide info header -->
                    <div class="bg-light border-bottom p-3">
                        <div class="d-flex align-items-center">
                            <img id="chatGuideImage" src="" class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;" alt="Guide Image">
                            <div>
                                <h6 class="mb-0 fw-bold" id="chatGuideName">Guide Name</h6>
                                <small class="text-muted">
                                    <i class="bi bi-circle-fill text-success me-1" style="font-size: 8px;"></i>Online
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat messages area -->
                    <div class="flex-grow-1 p-3 overflow-auto" id="chatMessages" style="background-color: #f8f9fa;">
                        <!-- Messages will be added here -->
                    </div>
                    
                    <!-- Message input area -->
                    <div class="border-top p-3 bg-white">
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatMessageInput" 
                                   placeholder="Type your message..." 
                                   style="border-radius: 25px 0 0 25px; border: 2px solid #e9ecef;">
                            <button class="btn btn-primary" type="button" id="sendMessageBtn" 
                                    style="border-radius: 0 25px 25px 0; background: linear-gradient(135deg, #17a2b8, #20c997); border: none;">
                                <i class="bi bi-send"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>Press Enter to send message
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true" style="z-index: 2100;">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="bookingModalLabel">
                        <i class="bi bi-calendar-check me-2"></i>Book Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">
                        <!-- Left Column: Guide Info -->
                        <div class="col-md-4 mb-4">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <img id="bookingGuideImage" src="" class="rounded-circle mb-3" style="width: 120px; height: 120px; object-fit: cover;" alt="Guide Image">
                                    <h5 id="bookingGuideName" class="fw-bold">Guide Name</h5>
                                    <p class="text-primary fw-bold mb-0">
                                        <i class="bi bi-currency-yen me-1"></i>
                                        <span id="bookingGuidePrice">Â¥0</span>/hour
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Middle Column: Booking Form -->
                        <div class="col-md-5 mb-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-calendar3 me-2"></i>Booking Details
                            </h6>
                            
                            <form id="bookingForm">
                                <div class="mb-3">
                                    <label for="bookingDate" class="form-label fw-bold">Date</label>
                                    <input type="date" class="form-control" id="bookingDate" name="date" required style="border-radius: 10px;">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingTime" class="form-label fw-bold">Start Time</label>
                                    <select class="form-select" id="bookingTime" name="time" required style="border-radius: 10px;">
                                        <option value="">Select time</option>
                                        <option value="09:00">09:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                        <option value="12:00">12:00</option>
                                        <option value="13:00">13:00</option>
                                        <option value="14:00">14:00</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:00">16:00</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingDuration" class="form-label fw-bold">Duration</label>
                                    <select class="form-select" id="bookingDuration" name="duration" required style="border-radius: 10px;">
                                        <option value="">Select duration</option>
                                        <option value="1">1 hour</option>
                                        <option value="2">2 hours (1.5x rate)</option>
                                        <option value="4">4 hours (2.5x rate)</option>
                                        <option value="8">8 hours (4x rate)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingParticipants" class="form-label fw-bold">Number of Participants</label>
                                    <select class="form-select" id="bookingParticipants" name="participants" required style="border-radius: 10px;">
                                        <option value="">Select participants</option>
                                        <option value="1">1 person</option>
                                        <option value="2">2 people</option>
                                        <option value="3">3 people</option>
                                        <option value="4">4 people</option>
                                        <option value="5">5 people</option>
                                        <option value="6">6+ people</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="specialRequests" class="form-label fw-bold">Special Requests</label>
                                    <textarea class="form-control" id="specialRequests" name="specialRequests" rows="3" 
                                              placeholder="Allergies, accessibility needs, special interests, etc." 
                                              style="border-radius: 10px;"></textarea>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Right Column: Booking Summary -->
                        <div class="col-md-3">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-receipt me-2"></i>Booking Summary
                            </h6>
                            
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <div id="bookingSummary" class="mb-3">
                                        <p class="text-muted">Please fill in the details</p>
                                    </div>
                                    
                                    <hr>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <strong>Total Amount:</strong>
                                        <span class="text-success fw-bold fs-5" id="bookingTotal">Â¥0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 bg-light" style="border-radius: 0 0 15px 15px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="submitBookingBtn" 
                            style="background: linear-gradient(135deg, #28a745, #20c997); border: none; border-radius: 25px; padding: 10px 30px;">
                        <i class="bi bi-calendar-check me-2"></i>Confirm Booking
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Management Center Modal -->
    <div class="modal fade" id="managementModal" tabindex="-1" aria-labelledby="managementModalLabel" aria-hidden="true" style="z-index: 2200;">
        <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
            <div class="modal-content" style="border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: none; backdrop-filter: blur(10px); max-height: 90vh; display: flex; flex-direction: column;">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b9d 100%); color: white; border-radius: 20px 20px 0 0; padding: 25px 30px; flex-shrink: 0;">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="managementModalLabel">
                        <div class="me-3" style="width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-gear-fill" style="font-size: 22px;"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.4rem;">ğŸ† ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼</div>
                            <small style="opacity: 0.9; font-weight: normal;">ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ»æ¯”è¼ƒãƒ»äºˆç´„ç®¡ç†</small>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
                </div>
                <div class="modal-body p-0" style="flex: 1; overflow-y: auto;">
                    <!-- Tab Navigation -->
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 10;">
                        <ul class="nav nav-pills nav-fill" id="managementTabs" role="tablist" style="background: rgba(255,255,255,0.5); border-radius: 30px; padding: 8px;">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active management-tab" id="bookmarks-tab" data-bs-toggle="pill" data-bs-target="#bookmarks" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-bookmark-star-fill me-2"></i>ğŸ“Œ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link management-tab" id="comparison-tab" data-bs-toggle="pill" data-bs-target="#comparison" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-bar-chart-line-fill me-2"></i>ğŸ“Š æ¯”è¼ƒãƒªã‚¹ãƒˆ
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link management-tab" id="bookings-tab" data-bs-toggle="pill" data-bs-target="#bookings" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-calendar-check-fill me-2"></i>ğŸ“… äºˆç´„å±¥æ­´
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link management-tab" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-gear-fill me-2"></i>âš™ï¸ è¨­å®š
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="tab-content p-4" id="managementTabContent" style="min-height: 400px; padding-bottom: 60px !important;">
                        <!-- Bookmarks Tab -->
                        <div class="tab-pane fade show active" id="bookmarks" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold text-primary">
                                    <i class="bi bi-bookmark-star-fill me-2"></i>ä¿å­˜ã—ãŸã‚¬ã‚¤ãƒ‰
                                </h5>
                                <button class="btn btn-outline-danger btn-sm" id="clearBookmarksBtn" style="border-radius: 20px; padding: 8px 16px;">
                                    <i class="bi bi-trash3 me-1"></i>ã™ã¹ã¦å‰Šé™¤
                                </button>
                            </div>
                            <div id="bookmarksList" class="row">
                                <div class="col-12 text-center py-5">
                                    <i class="bi bi-clock-history" style="font-size: 3rem; color: #6c757d; opacity: 0.5;"></i>
                                    <p class="text-muted mt-3 mb-0" style="font-size: 1.1rem;">ä¿å­˜ã•ã‚ŒãŸã‚¬ã‚¤ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                                    <small class="text-muted">ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ã®â­ãƒœã‚¿ãƒ³ã§ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã§ãã¾ã™</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comparison Tab -->
                        <div class="tab-pane fade" id="comparison" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold text-success">
                                    <i class="bi bi-bar-chart-line-fill me-2"></i>æ¯”è¼ƒä¸­ã®ã‚¬ã‚¤ãƒ‰
                                </h5>
                                <button class="btn btn-outline-danger btn-sm" id="clearComparisonBtn" style="border-radius: 20px; padding: 8px 16px;">
                                    <i class="bi bi-trash3 me-1"></i>ã™ã¹ã¦å‰Šé™¤
                                </button>
                            </div>
                            <div id="comparisonList" class="row">
                                <div class="col-12 text-center py-5">
                                    <i class="bi bi-clock-history" style="font-size: 3rem; color: #6c757d; opacity: 0.5;"></i>
                                    <p class="text-muted mt-3 mb-0" style="font-size: 1.1rem;">æ¯”è¼ƒä¸­ã®ã‚¬ã‚¤ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                                    <small class="text-muted">ã‚¬ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ã®âœ“ãƒœã‚¿ãƒ³ã§æ¯”è¼ƒãƒªã‚¹ãƒˆã«è¿½åŠ ã§ãã¾ã™ï¼ˆæœ€å¤§3ä»¶ï¼‰</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bookings Tab -->
                        <div class="tab-pane fade" id="bookings" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold text-info">
                                    <i class="bi bi-calendar-check-fill me-2"></i>äºˆç´„å±¥æ­´
                                </h5>
                                <button class="btn btn-outline-info btn-sm" id="refreshBookingsBtn" style="border-radius: 20px; padding: 8px 16px;">
                                    <i class="bi bi-arrow-clockwise me-1"></i>æ›´æ–°
                                </button>
                            </div>
                            <div id="bookingsList" class="row">
                                <div class="col-12 text-center py-5">
                                    <i class="bi bi-calendar-x" style="font-size: 3rem; color: #6c757d; opacity: 0.5;"></i>
                                    <p class="text-muted mt-3 mb-0" style="font-size: 1.1rem;">äºˆç´„å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                                    <small class="text-muted">ã‚¬ã‚¤ãƒ‰ã¨äºˆç´„ãŒå®Œäº†ã™ã‚‹ã¨å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Settings Tab -->
                        <div class="tab-pane fade" id="settings" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5 class="mb-4 fw-bold text-secondary">
                                        <i class="bi bi-sliders me-2"></i>è¨­å®š
                                    </h5>
                                    <div class="mb-4">
                                        <label for="defaultLanguageSetting" class="form-label fw-bold">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èª</label>
                                        <select class="form-select" id="defaultLanguageSetting" style="border-radius: 10px;">
                                            <option value="en">ğŸ‡ºğŸ‡¸ Englishï¼ˆè‹±èªï¼‰</option>
                                            <option value="ja" selected>ğŸ‡¯ğŸ‡µ Japaneseï¼ˆæ—¥æœ¬èªï¼‰</option>
                                        </select>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">é€šçŸ¥è¨­å®š</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                                            <label class="form-check-label" for="notificationsEnabled">
                                                æ–°ã—ã„ã‚¬ã‚¤ãƒ‰ç™»éŒ²æ™‚ã«é€šçŸ¥ã‚’å—ã‘å–ã‚‹
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h5 class="mb-4 fw-bold text-secondary">
                                        <i class="bi bi-database me-2"></i>ãƒ‡ãƒ¼ã‚¿ç®¡ç†
                                    </h5>
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-outline-primary" id="exportDataBtn" style="border-radius: 15px; padding: 12px;">
                                            <i class="bi bi-download me-2"></i>ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                        </button>
                                        <button class="btn btn-outline-warning" id="clearAllDataBtn" style="border-radius: 15px; padding: 12px;">
                                            <i class="bi bi-exclamation-triangle me-2"></i>ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                                        </button>
                                        <button class="btn btn-outline-info" id="dataStatsBtn" style="border-radius: 15px; padding: 12px;">
                                            <i class="bi bi-bar-chart me-2"></i>ğŸ“Š ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 0 0 20px 20px; padding: 20px 30px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 25px; background: linear-gradient(135deg, #6c757d, #495057); border: none;">
                        <i class="bi bi-x-circle me-2"></i>é–‰ã˜ã‚‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Management Center Functions
        function showManagementCenter() {
            console.log('Opening Management Center...');
            try {
                loadManagementData();
                const managementModal = new bootstrap.Modal(document.getElementById('managementModal'));
                managementModal.show();
                console.log('âœ… Management Center opened successfully');
            } catch (error) {
                console.error('âŒ Error showing management center:', error);
                alert('Error opening management center: ' + error.message);
            }
        }
        
        function loadManagementData() {
            console.log('ğŸ“Š Loading management data...');
            try {
                loadBookmarksList();
                loadComparisonList();
                loadBookingsList();
                loadSettingsData();
                console.log('âœ… Management data loaded successfully');
            } catch (error) {
                console.error('âŒ Error loading management data:', error);
            }
        }
        
        function loadBookmarksList() {
            try {
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const bookmarksList = document.getElementById('bookmarksList');
                
                if (!bookmarksList) return;
                
                if (bookmarkedGuides.length === 0) {
                    bookmarksList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-bookmark text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">No saved guides</p>
                        </div>
                    `;
                    return;
                }
                
                const allGuides = loadAllGuides();
                bookmarksList.innerHTML = bookmarkedGuides.map(guideId => {
                    const guide = allGuides.find(g => g.id == guideId);
                    if (!guide) return '';
                    
                    return `
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="row g-0">
                                <div class="col-4">
                                    <img src="${guide.image}" class="img-fluid rounded-start h-100" style="object-fit: cover;" alt="${guide.name}">
                                </div>
                                <div class="col-8">
                                    <div class="card-body p-3">
                                        <h6 class="card-title mb-1">${guide.name}</h6>
                                        <p class="card-text small text-muted mb-2">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</p>
                                        <p class="card-text"><strong>Â¥${(guide.price || 0).toLocaleString()}</strong></p>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-outline-primary btn-sm" onclick="showGuideDetailModalById(${guide.id})">Details</button>
                                            <button class="btn btn-outline-danger btn-sm" onclick="removeBookmark(${guide.id})">Remove</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading bookmarks:', error);
                const bookmarksList = document.getElementById('bookmarksList');
                if (bookmarksList) {
                    bookmarksList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading bookmarks</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadComparisonList() {
            try {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const comparisonList = document.getElementById('comparisonList');
                
                if (!comparisonList) return;
                
                if (comparisonGuides.length === 0) {
                    comparisonList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-graph-up text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">No guides in comparison</p>
                        </div>
                    `;
                    return;
                }
                
                const allGuides = loadAllGuides();
            comparisonList.innerHTML = comparisonGuides.map(guideId => {
                const guide = allGuides.find(g => g.id == guideId);
                if (!guide) return '';
                
                return `
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <img src="${guide.image}" class="card-img-top" style="height: 120px; object-fit: cover;" alt="${guide.name}">
                            <div class="card-body p-3 d-flex flex-column">
                                <h6 class="card-title mb-1">${guide.name}</h6>
                                <p class="card-text small text-muted mb-1">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</p>
                                <p class="card-text small mb-2"><span class="text-warning">â˜…</span> ${guide.rating}</p>
                                <p class="card-text mb-3"><strong>Â¥${(guide.price || 0).toLocaleString()}</strong></p>
                                <div class="mt-auto">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="showGuideDetailModalById(${guide.id})">
                                            <i class="bi bi-info-circle me-1"></i>Details
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm" onclick="removeFromComparison(${guide.id})">
                                            <i class="bi bi-x me-1"></i>Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error loading comparison list:', error);
                const comparisonList = document.getElementById('comparisonList');
                if (comparisonList) {
                    comparisonList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading comparison list</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadBookingsList() {
            try {
                const userBookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
                const bookingsList = document.getElementById('bookingsList');
                
                if (!bookingsList) return;
            
            if (userBookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3">No booking history</p>
                    </div>
                `;
                return;
            }
            
            const statusBadge = {
                'pending': '<span class="badge bg-warning">Pending</span>',
                'confirmed': '<span class="badge bg-success">Confirmed</span>',
                'completed': '<span class="badge bg-primary">Completed</span>',
                'cancelled': '<span class="badge bg-danger">Cancelled</span>'
            };
            
            bookingsList.innerHTML = userBookings.map(booking => {
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <h6 class="mb-1">${booking.guideName}</h6>
                                    <small class="text-muted">${booking.date}</small>
                                </div>
                                <div class="col-md-3">
                                    <small class="text-muted">Duration</small>
                                    <div>${booking.duration}</div>
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>${booking.totalPrice}</strong>
                                </div>
                                <div class="col-md-2 text-center">
                                    ${statusBadge[booking.status] || statusBadge['pending']}
                                    <div class="mt-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="viewBookingDetails(${booking.id})">Details</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error loading bookings:', error);
                const bookingsList = document.getElementById('bookingsList');
                if (bookingsList) {
                    bookingsList.innerHTML = `
                        <div class="text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading booking history</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadSettingsData() {
            try {
                // Load saved language preference
                const savedLang = localStorage.getItem('preferredLanguage') || 'en';
                const langSetting = document.getElementById('defaultLanguageSetting');
                if (langSetting) langSetting.value = savedLang;
                
                    // Load notification setting
                const notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
                const notificationSetting = document.getElementById('notificationsEnabled');
                if (notificationSetting) notificationSetting.checked = notificationsEnabled;
            } catch (error) {
                console.error('Error loading settings:', error);
            }
            
            // Setup delete button event listeners for management center (improved timing)
            const setupDeleteButtons = function() {
                const clearBookmarksBtn = document.getElementById('clearBookmarksBtn');
                if (clearBookmarksBtn && !clearBookmarksBtn.hasAttribute('data-listener-attached')) {
                    clearBookmarksBtn.addEventListener('click', function() {
                        if (typeof clearAllBookmarks === 'function') {
                            clearAllBookmarks();
                        } else {
                            if (confirm('æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                                localStorage.removeItem('bookmarkedGuides');
                                if (typeof loadBookmarksList === 'function') loadBookmarksList();
                                if (typeof updateBookmarkButtons === 'function') updateBookmarkButtons();
                                console.log('âœ… All bookmarks cleared');
                            }
                        }
                    });
                    clearBookmarksBtn.setAttribute('data-listener-attached', 'true');
                }
            
                
                const clearComparisonBtn = document.getElementById('clearComparisonBtn');
                if (clearComparisonBtn && !clearComparisonBtn.hasAttribute('data-listener-attached')) {
                    clearComparisonBtn.addEventListener('click', function() {
                        if (typeof clearAllComparisons === 'function') {
                            clearAllComparisons();
                        } else {
                            if (confirm('æœ¬å½“ã«ã™ã¹ã¦ã®æ¯”è¼ƒãƒªã‚¹ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                                localStorage.removeItem('comparisonGuides');
                                if (typeof loadComparisonList === 'function') loadComparisonList();
                                if (typeof updateComparisonButtons === 'function') updateComparisonButtons();
                                console.log('âœ… All comparison guides cleared');
                            }
                        }
                    });
                    clearComparisonBtn.setAttribute('data-listener-attached', 'true');
                }
            
            document.getElementById('clearBookingsBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all booking history?')) {
                    localStorage.removeItem('userBookings');
                    loadBookingsList();
                }
            });
            
                
                const clearAllDataBtn = document.getElementById('clearAllDataBtn');
                if (clearAllDataBtn && !clearAllDataBtn.hasAttribute('data-listener-attached')) {
                    clearAllDataBtn.addEventListener('click', function() {
                        if (confirm('æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                            localStorage.clear();
                            alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚');
                            if (typeof loadManagementData === 'function') loadManagementData();
                            if (typeof updateBookmarkButtons === 'function') updateBookmarkButtons();
                            if (typeof updateComparisonButtons === 'function') updateComparisonButtons();
                            console.log('âœ… All data cleared');
                        }
                    });
                    clearAllDataBtn.setAttribute('data-listener-attached', 'true');
                }
            };
            
            // Attach to modal events
            const managementModal = document.getElementById('managementModal');
            if (managementModal) {
                managementModal.addEventListener('shown.bs.modal', setupDeleteButtons);
                setTimeout(setupDeleteButtons, 100);
            }
        }
        
        // Management functions
        function removeBookmark(guideId) {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            const updatedBookmarks = bookmarkedGuides.filter(id => id != guideId);
            localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
            loadBookmarksList();
            
            // Update bookmark buttons throughout the page
            updateBookmarkButtons();
            console.log('Removed bookmark for guide:', guideId);
        }
        
        function removeFromComparison(guideId) {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            const updatedComparison = comparisonGuides.filter(id => id != guideId);
            localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
            loadComparisonList();
            
            // Update comparison buttons throughout the page
            updateComparisonButtons();
            console.log('Removed from comparison:', guideId);
        }
        
        function viewBookingDetails(bookingId) {
            window.location.href = `booking-confirmation.html?id=${bookingId}`;
        }

        // Bookmark and comparison functionality
        function toggleBookmark(guideId) {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            // Convert to string for consistent comparison
            const guideIdStr = guideId.toString();
            const isBookmarked = bookmarkedGuides.includes(guideIdStr) || bookmarkedGuides.includes(parseInt(guideId));
            
            if (isBookmarked) {
                // Remove bookmark - handle both string and number formats
                const updatedBookmarks = bookmarkedGuides.filter(id => id != guideIdStr && id != parseInt(guideId));
                localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
                console.log('Removed bookmark for guide:', guideId);
            } else {
                // Add bookmark as string
                bookmarkedGuides.push(guideIdStr);
                localStorage.setItem('bookmarkedGuides', JSON.stringify(bookmarkedGuides));
                console.log('Add to bookmarks:', guideId);
            }
            
            // Update button appearance
            updateBookmarkButtons();
        }
        
        function toggleComparison(guideId) {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            // Convert to string for consistent comparison
            const guideIdStr = guideId.toString();
            const isInComparison = comparisonGuides.includes(guideIdStr) || comparisonGuides.includes(parseInt(guideId));
            
            if (isInComparison) {
                // Remove from comparison - handle both string and number formats
                const updatedComparison = comparisonGuides.filter(id => id != guideIdStr && id != parseInt(guideId));
                localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
                console.log('Removed from comparison:', guideId);
            } else {
                // Add to comparison (limit to 3)
                if (comparisonGuides.length >= 3) {
                    alert('Comparison list is limited to 3 guides. Please remove other guides before adding new ones.');
                    return;
                }
                comparisonGuides.push(guideIdStr);
                localStorage.setItem('comparisonGuides', JSON.stringify(comparisonGuides));
                console.log('Add to comparison:', guideId);
            }
            
            // Update button appearance
            updateComparisonButtons();
        }
        
        function updateBookmarkButtons() {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                const guideId = btn.getAttribute('data-guide-id');
                // Check both string and number formats for compatibility
                const isBookmarked = bookmarkedGuides.includes(guideId) || bookmarkedGuides.includes(parseInt(guideId));
                
                if (isBookmarked) {
                    btn.classList.remove('btn-outline-warning');
                    btn.classList.add('btn-warning');
                    btn.innerHTML = 'â˜…';
                } else {
                    btn.classList.remove('btn-warning');
                    btn.classList.add('btn-outline-warning');
                    btn.innerHTML = 'â­';
                }
            });
        }
        
        function updateComparisonButtons() {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            document.querySelectorAll('.compare-btn').forEach(btn => {
                const guideId = btn.getAttribute('data-guide-id');
                // Check both string and number formats for compatibility
                const isInComparison = comparisonGuides.includes(guideId) || comparisonGuides.includes(parseInt(guideId));
                
                if (isInComparison) {
                    btn.classList.remove('btn-outline-success');
                    btn.classList.add('btn-success');
                    btn.innerHTML = 'âœ“';
                } else {
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-success');
                    btn.innerHTML = '+';
                }
            });
        }
        
        // Show guide detail modal from management center
        function showGuideDetailModalById(guideId) {
            console.log('Opening guide detail modal for guide:', guideId);
            // Use existing viewGuideDetail function if available
            if (window.viewGuideDetail) {
                const fakeEvent = { preventDefault: () => {}, stopPropagation: () => {} };
                window.viewGuideDetail(guideId, fakeEvent);
            } else {
                // Fallback: redirect to main page with guide detail
                alert('Redirecting to main page to show guide details.');
                window.location.href = `/?guideId=${guideId}`;
            }
        }

        // Footer Functions
        function showAbout() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'About Us';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>About TomoTrip</h6>
                <p>TomoTrip is an innovative platform connecting travelers with trusted local guides across Japan.</p>
                <h6>Our Mission</h6>
                <ul>
                    <li>Discover and nurture specialized local guides who showcase regional attractions</li>
                    <li>Provide safe and enriching travel experiences for tourists</li>
                    <li>Promote local economic development and cultural exchange</li>
                    <li>contribute to sustainable tourism industry growth</li>
                </ul>
                <h6>Service Launch</h6>
                <p>Operating nationwide across all 47 prefectures since 2025</p>
            `;
            modal.show();
        }

        function showTerms() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Terms of Service';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Article 1: Service Overview</h6>
                <p>This service is a matching platform between guides and tourists.</p>
                <h6>Article 2: User Responsibilities</h6>
                <ul>
                    <li>Provide accurate information during registration</li>
                    <li>Show consideration for other users</li>
                    <li>Comply with applicable laws and regulations</li>
                </ul>
                <h6>Article 3: Prohibited Activities</h6>
                <ul>
                    <li>Providing false information</li>
                    <li>Business interference activities</li>
                    <li>Activities that cause inconvenience to third parties</li>
                </ul>
                <p class="text-muted small">Last updated: January 1, 2025</p>
            `;
            modal.show();
        }

        function showPrivacy() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Privacy Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Personal Information Handling</h6>
                <p>TomoTrip uses your personal information for the following purposes:</p>
                <ul>
                    <li>Service provision and operation</li>
                    <li>Customer support</li>
                    <li>Safety and security</li>
                    <li>Service improvement analysis</li>
                </ul>
                <h6>Third Party Disclosure</h6>
                <p>We do not provide personal information to third parties without your consent, except as required by law.</p>
                <h6>Contact</h6>
                <p>For privacy-related inquiries: privacy@tomotrip.com</p>
            `;
            modal.show();
        }

        function showFAQ() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Frequently Asked Questions';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq1">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1">
                                Is guide registration free?
                            </button>
                        </h2>
                        <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Yes, guide registration is completely free. Commission is only 20% upon successful booking.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse2">
                                When do cancellation fees apply?
                            </button>
                        </h2>
                        <div id="faqCollapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Up to 7 days before: Free<br>
                                3-6 days before: 50%<br>
                                2 days or less: 100%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            modal.show();
        }

        function showSafety() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Safety & Insurance';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Safety Measures</h6>
                <ul>
                    <li>Identity verification for all guides</li>
                    <li>24/7 emergency support system</li>
                    <li>GPS location sharing feature</li>
                    <li>Guide rating and review system</li>
                </ul>
                <h6>Insurance Coverage</h6>
                <p>Travel accident insurance applies to all tours.</p>
                <h6>Emergency Contact</h6>
                <p>24-hour support: +81-80-1234-5678</p>
            `;
            modal.show();
        }

        function showCancellation() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Cancellation Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Cancellation Fees</h6>
                <table class="table table-sm">
                    <tr><td>Up to 7 days before</td><td>Free</td></tr>
                    <tr><td>3-6 days before</td><td>50% of fee</td></tr>
                    <tr><td>1-2 days before / Same day</td><td>100% of fee</td></tr>
                </table>
                <h6>Weather Cancellations</h6>
                <p>Full refund provided for weather-related cancellations.</p>
                <h6>Refund Method</h6>
                <p>Credit card refunds are processed within 5-7 business days.</p>
            `;
            modal.show();
        }

        function showCookies() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Cookie Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Cookie Usage</h6>
                <ul>
                    <li>Save user preferences</li>
                    <li>Maintain login status</li>
                    <li>Analyze site usage</li>
                    <li>Provide personalized experiences</li>
                </ul>
                <h6>ã‚¯ãƒƒã‚­ãƒ¼è¨­å®šã®å¤‰æ›´</h6>
                <p>ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ã‚¯ãƒƒã‚­ãƒ¼ã‚’ç„¡åŠ¹ã«ã§ãã¾ã™ãŒã€ä¸€éƒ¨ã®æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
            `;
            modal.show();
        }

        function createFooterModal() {
            const modalHTML = `
                <div class="modal fade" id="footerModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="footerModalTitle"></h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" id="footerModalBody"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('footerModal');
        }
    </script>

    <!-- Footer Modal Functions -->
    <script>
        // Enhanced footer modal creation function
        function createFooterModal() {
            // Remove existing modal
            const existingModal = document.getElementById('footerModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'footerModal';
            modal.setAttribute('tabindex', '-1');
            modal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content bg-dark text-light">
                        <div class="modal-header border-secondary">
                            <h5 class="modal-title text-white" id="footerModalTitle"></h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="footerModalBody">
                        </div>
                        <div class="modal-footer border-secondary">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }
        
        function showAbout() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'About TomoTrip';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="assets/images/tomotrip-logo.png" alt="TomoTrip" style="height: 50px;" class="me-3">
                        <h4 class="text-primary mb-0">TomoTrip</h4>
                    </div>
                    <p class="lead">Connecting travelers with trusted local guides for authentic and safe travel experiences across Japan.</p>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card bg-gradient h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-globe me-2"></i>Our Mission</h5>
                                <p class="card-text">To bridge cultures and create meaningful connections between travelers and local communities through authentic experiences.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card bg-gradient h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-shield-check me-2"></i>Our Promise</h5>
                                <p class="card-text">Safe, reliable, and enriching travel experiences with vetted guides who are passionate about sharing their culture.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6 class="fw-bold">Company Information</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <small class="text-muted">Founded</small>
                            <p class="mb-0">2024</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Headquarters</small>
                            <p class="mb-0">Tokyo, Japan</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Languages</small>
                            <p class="mb-0">Japanese, English</p>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showTerms() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Terms of Service';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Last Updated:</strong> January 2025
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">1. Service Overview</h6>
                    <p class="small">TomoTrip is a platform connecting tourists with local guides in Japan. By using our service, you agree to these terms and conditions.</p>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">2. User Responsibilities</h6>
                    <ul class="small">
                        <li>Provide accurate registration information</li>
                        <li>Respect local customs and guidelines</li>
                        <li>Follow safety instructions from guides</li>
                        <li>Make payments as agreed</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">3. Guide Requirements</h6>
                    <ul class="small">
                        <li>Valid identification and certification</li>
                        <li>Comprehensive local knowledge</li>
                        <li>Professional conduct at all times</li>
                        <li>Insurance coverage compliance</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">4. Payment Terms</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Tourist Payments</h6>
                                    <ul class="card-text small">
                                        <li>Full payment required at booking</li>
                                        <li>Credit card fees (3.6%) apply</li>
                                        <li>Debit card processing (2.1%)</li>
                                        <li>Secure payment processing</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Guide Compensation</h6>
                                    <ul class="card-text small">
                                        <li>80% of tour fee after completion</li>
                                        <li>20% platform service fee</li>
                                        <li>Payment within 5 business days</li>
                                        <li>Direct bank transfer</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-exclamation-triangle me-2"></i>These terms are subject to Japanese law. For disputes, Tokyo District Court has jurisdiction.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showPrivacy() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Privacy Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-primary">
                        <i class="bi bi-shield-lock me-2"></i>
                        <strong>Your privacy is our priority.</strong> This policy explains how we collect, use, and protect your personal information.
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Information We Collect</h6>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-primary">Personal Information</h6>
                                    <ul class="card-text small">
                                        <li>Name and contact details</li>
                                        <li>Profile photos</li>
                                        <li>Identity verification documents</li>
                                        <li>Payment information</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Usage Data</h6>
                                    <ul class="card-text small">
                                        <li>Website interaction data</li>
                                        <li>Search preferences</li>
                                        <li>Booking history</li>
                                        <li>Communication records</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">How We Use Your Information</h6>
                    <ul class="small">
                        <li>Facilitate connections between tourists and guides</li>
                        <li>Process payments and bookings</li>
                        <li>Improve our service quality</li>
                        <li>Ensure safety and security</li>
                        <li>Comply with legal requirements</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Data Protection Rights</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Access</small>
                                    <br><small>View your data</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Correction</small>
                                    <br><small>Update incorrect information</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Deletion</small>
                                    <br><small>Request data removal</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Portability</small>
                                    <br><small>Export your data</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small><i class="bi bi-envelope me-2"></i>For privacy-related inquiries, contact us at privacy@tomotrip.com</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showFAQ() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Frequently Asked Questions';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <p class="lead">Find answers to common questions about using TomoTrip.</p>
                </div>
                
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                <i class="bi bi-person-check me-2"></i>How do I book a guide?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <p>Booking a guide is simple:</p>
                                <ol>
                                    <li>Browse available guides in your desired location</li>
                                    <li>Check their profiles, reviews, and availability</li>
                                    <li>Register as a tourist (one-time process)</li>
                                    <li>Select your preferred guide and time slot</li>
                                    <li>Complete payment to confirm your booking</li>
                                </ol>
                                <div class="alert alert-info mt-3">
                                    <small><i class="bi bi-lightbulb me-2"></i>Tip: Book in advance, especially during peak seasons!</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                <i class="bi bi-credit-card me-2"></i>What payment methods do you accept?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <p>We accept various payment methods for your convenience:</p>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title text-success">Credit Cards</h6>
                                                <ul class="small">
                                                    <li>Visa, Mastercard, JCB</li>
                                                    <li>3.6% processing fee</li>
                                                    <li>Instant confirmation</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title text-info">Debit Cards</h6>
                                                <ul class="small">
                                                    <li>All major debit cards</li>
                                                    <li>2.1% processing fee</li>
                                                    <li>Direct bank deduction</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                <i class="bi bi-calendar-x me-2"></i>What is your cancellation policy?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="card border-success">
                                            <div class="card-body text-center">
                                                <div class="text-success h4">48+ hours</div>
                                                <small>Full refund</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-warning">
                                            <div class="card-body text-center">
                                                <div class="text-warning h4">24-48 hours</div>
                                                <small>50% refund</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-danger">
                                            <div class="card-body text-center">
                                                <div class="text-danger h4">&lt;24 hours</div>
                                                <small>No refund</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 small">Refunds are processed within 5-7 business days to your original payment method.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showSafety() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Safety & Insurance';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="bi bi-shield-check me-2"></i>
                        <strong>Your safety is our top priority.</strong> We implement multiple layers of protection for all users.
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-person-check me-2"></i>Guide Verification</h5>
                                <ul class="card-text">
                                    <li>Identity verification required</li>
                                    <li>Background checks conducted</li>
                                    <li>Local certification validation</li>
                                    <li>Regular performance reviews</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-shield-lock me-2"></i>Insurance Coverage</h5>
                                <ul class="card-text">
                                    <li>Comprehensive liability insurance</li>
                                    <li>Medical emergency coverage</li>
                                    <li>Activity-specific protection</li>
                                    <li>24/7 emergency support</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Safety Guidelines</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-primary">For Tourists</h6>
                                    <ul class="card-text small">
                                        <li>Share your itinerary with someone</li>
                                        <li>Keep emergency contacts handy</li>
                                        <li>Follow guide instructions</li>
                                        <li>Stay aware of your surroundings</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">For Guides</h6>
                                    <ul class="card-text small">
                                        <li>Conduct safety briefings</li>
                                        <li>Monitor group dynamics</li>
                                        <li>Maintain first aid certification</li>
                                        <li>Report incidents immediately</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-telephone me-2"></i><strong>Emergency Contact:</strong> 080-9999-8888 (24/7 Support)</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCancellation() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Cancellation Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Flexible cancellation options</strong> designed to accommodate unexpected changes while protecting both tourists and guides.
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Cancellation Timeline</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-success h-100">
                                <div class="card-body text-center">
                                    <div class="text-success display-6 mb-2"><i class="bi bi-check-circle"></i></div>
                                    <h6 class="card-title text-success">48+ Hours Before</h6>
                                    <p class="card-text">
                                        <strong>100% Refund</strong><br>
                                        <small class="text-muted">Full amount returned to original payment method</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning h-100">
                                <div class="card-body text-center">
                                    <div class="text-warning display-6 mb-2"><i class="bi bi-exclamation-circle"></i></div>
                                    <h6 class="card-title text-warning">24-48 Hours Before</h6>
                                    <p class="card-text">
                                        <strong>50% Refund</strong><br>
                                        <small class="text-muted">Partial compensation for guide preparation</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-danger h-100">
                                <div class="card-body text-center">
                                    <div class="text-danger display-6 mb-2"><i class="bi bi-x-circle"></i></div>
                                    <h6 class="card-title text-danger">Less than 24 Hours</h6>
                                    <p class="card-text">
                                        <strong>No Refund</strong><br>
                                        <small class="text-muted">Guide compensation protection</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Special Circumstances</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Weather Conditions</h6>
                                    <ul class="card-text small">
                                        <li>Typhoon/severe weather warnings</li>
                                        <li>Government-issued travel advisories</li>
                                        <li>Full refund provided</li>
                                        <li>Rescheduling options available</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Medical Emergencies</h6>
                                    <ul class="card-text small">
                                        <li>Tourist illness or injury</li>
                                        <li>Guide inability to conduct tour</li>
                                        <li>Medical documentation required</li>
                                        <li>Case-by-case evaluation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">How to Cancel</h6>
                    <ol class="small">
                        <li>Log into your account or use booking confirmation email</li>
                        <li>Navigate to "My Bookings" section</li>
                        <li>Select the booking you wish to cancel</li>
                        <li>Click "Cancel Booking" and confirm</li>
                        <li>Receive cancellation confirmation and refund timeline</li>
                    </ol>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-clock me-2"></i>Refunds are processed within 5-7 business days. For urgent cancellations, contact our support team.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showHelp() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Help Center';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <p class="lead">Need assistance? We're here to help you make the most of your TomoTrip experience.</p>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-headset me-2"></i>Live Chat Support</h5>
                                <p class="card-text">Get instant help from our support team during business hours.</p>
                                <button class="btn btn-light" onclick="window.open('chat.html', '_blank')">
                                    <i class="bi bi-chat-dots me-2"></i>Start Chat
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-envelope me-2"></i>Email Support</h5>
                                <p class="card-text">Send us detailed questions and we'll respond within 24 hours.</p>
                                <button class="btn btn-light" onclick="window.location.href='mailto:support@tomotrip.com'">
                                    <i class="bi bi-envelope me-2"></i>Send Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Quick Help Topics</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="list-group">
                                <div class="list-group-item bg-dark text-light border-secondary">
                                    <h6 class="mb-1">For Tourists</h6>
                                    <small>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showFAQ()">How to book a guide</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showCancellation()">Cancellation policy</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showSafety()">Safety guidelines</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="alert('Payment help coming soon')">Payment issues</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="list-group">
                                <div class="list-group-item bg-dark text-light border-secondary">
                                    <h6 class="mb-1">For Guides</h6>
                                    <small>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Guide registration help coming soon')">Registration process</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Profile optimization tips coming soon')">Profile optimization</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Earnings dashboard coming soon')">Payment schedule</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Guide resources coming soon')">Best practices</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Contact Information</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-telephone text-primary fs-4"></i>
                                    <h6 class="mt-2">Phone Support</h6>
                                    <small>+81-3-1234-5678<br>Mon-Fri 9:00-18:00 JST</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-envelope text-success fs-4"></i>
                                    <h6 class="mt-2">Email</h6>
                                    <small>support@tomotrip.com<br>24h response time</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-exclamation-triangle text-warning fs-4"></i>
                                    <h6 class="mt-2">Emergency</h6>
                                    <small>080-9999-8888<br>24/7 Support</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCompliance() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Legal Compliance';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="bi bi-shield-check me-2"></i>
                        <strong>Full Legal Compliance</strong> - TomoTrip operates in accordance with Japanese and international laws.
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-primary"><i class="bi bi-building me-2"></i>Business Registration</h5>
                                <ul class="card-text small">
                                    <li>Registered in Tokyo, Japan</li>
                                    <li>Business License: TK-2024-001</li>
                                    <li>Tourism Agency Registration</li>
                                    <li>Regular compliance audits</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-success"><i class="bi bi-shield-lock me-2"></i>Data Protection</h5>
                                <ul class="card-text small">
                                    <li>GDPR compliance (EU users)</li>
                                    <li>Japanese Personal Information Protection Act</li>
                                    <li>Secure data encryption</li>
                                    <li>Regular security assessments</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Industry Certifications</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <div class="text-success h4"><i class="bi bi-award"></i></div>
                                    <h6>Tourism Quality</h6>
                                    <small>Certified by Japan Tourism Agency</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <div class="text-info h4"><i class="bi bi-lock"></i></div>
                                    <h6>Security Standards</h6>
                                    <small>ISO 27001 Certified</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning">
                                <div class="card-body text-center">
                                    <div class="text-warning h4"><i class="bi bi-credit-card"></i></div>
                                    <h6>Payment Security</h6>
                                    <small>PCI DSS Compliant</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Legal Framework</h6>
                    <div class="table-responsive">
                        <table class="table table-dark table-striped">
                            <thead>
                                <tr>
                                    <th>Law/Regulation</th>
                                    <th>Compliance Status</th>
                                    <th>Last Audit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Tourism Business Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                                <tr>
                                    <td>Consumer Protection Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                                <tr>
                                    <td>Data Protection Laws</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Dec 2024</td>
                                </tr>
                                <tr>
                                    <td>Payment Services Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small><i class="bi bi-info-circle me-2"></i>For legal inquiries or compliance questions, contact our legal team at legal@tomotrip.com</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCookies() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Cookie Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <h6 class="fw-bold">What are Cookies?</h6>
                    <p class="small">Cookies are small text files that websites store on your computer to improve your browsing experience and provide better services.</p>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Types of Cookies We Use</h6>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Essential Cookies</h6>
                                    <p class="card-text small">Required for basic website functionality</p>
                                    <ul class="small">
                                        <li>Login session management</li>
                                        <li>Security features</li>
                                        <li>Settings preservation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Analytics Cookies</h6>
                                    <p class="card-text small">Help us improve our services</p>
                                    <ul class="small">
                                        <li>Google Analytics</li>
                                        <li>Usage statistics</li>
                                        <li>Performance monitoring</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">ã‚¯ãƒƒã‚­ãƒ¼è¨­å®šã®ç®¡ç†</h6>
                    <p class="small">ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ã‚¯ãƒƒã‚­ãƒ¼ã®å—ã‘å…¥ã‚Œã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚ãŸã ã—ã€å¿…é ˆã‚¯ãƒƒã‚­ãƒ¼ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æ©Ÿèƒ½ã«å½±éŸ¿ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                    
                    <div class="mt-3">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="alert('ã‚¯ãƒƒã‚­ãƒ¼è¨­å®šãƒ‘ãƒãƒ«ã¯é–‹ç™ºä¸­ã§ã™')">ã‚¯ãƒƒã‚­ãƒ¼è¨­å®š</button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="alert('ã‚¯ãƒƒã‚­ãƒ¼å‰Šé™¤æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™')">ã™ã¹ã¦ã®ã‚¯ãƒƒã‚­ãƒ¼ã‚’å‰Šé™¤</button>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-exclamation-triangle me-2"></i>Analytics cookies require your consent. You can use our basic features without accepting analytics cookies.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showManagementCenter() {
            alert('Booking Management Center is under development. Please contact us directly for current booking inquiries.');
        }
    </script>

    
    <!-- Management Center Tab CSS -->
    <style>
        /* Management Center Tab Styling */
        .management-tab {
            background: rgba(255,255,255,0.3) !important;
            color: #6c757d !important;
        }
        
        .management-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2) !important;
            color: white !important;
        }
        
        .management-tab:hover:not(.active) {
            background: rgba(255,255,255,0.6) !important;
            color: #495057 !important;
        }
    </style>
    
    <!-- Footer Force CSS -->
    <style>
        .footer-forced-visible {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1000 !important;
            min-height: 400px !important;
        }
        
        /* Footer Emergency Fix */
        #main-footer {
            background-color: #212529 !important;
            color: white !important;
            padding: 3rem 0 !important;
            margin-top: 2rem !important;
            position: relative !important;
            z-index: 100 !important;
            width: 100% !important;
            clear: both !important;
        }
        
        #main-footer .container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 15px !important;
        }
        
        #main-footer .row {
            display: flex !important;
            flex-wrap: wrap !important;
            margin: 0 -15px !important;
        }
        
        #main-footer .col-lg-3,
        #main-footer .col-lg-2,
        #main-footer .col-md-6 {
            padding: 0 15px !important;
            margin-bottom: 2rem !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            flex: 1 1 auto !important;
            min-width: 200px !important;
        }
        
        #main-footer h5,
        #main-footer h6 {
            color: white !important;
            font-weight: bold !important;
            margin-bottom: 1rem !important;
        }
        
        #main-footer p,
        #main-footer li,
        #main-footer a {
            color: #adb5bd !important;
            font-size: 14px !important;
        }
        
        #main-footer a:hover {
            color: #4ecdc4 !important;
        }
        
        #main-footer .text-white {
            color: white !important;
        }
        
        #main-footer .text-muted {
            color: #adb5bd !important;
        }
        
        #main-footer ul {
            list-style: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        
        #main-footer li {
            margin-bottom: 0.5rem !important;
        }
        
        .hover-social:hover {
            color: #4ecdc4 !important;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .hover-link:hover {
            color: #4ecdc4 !important;
            text-decoration: underline !important;
        }
    </style>

    <!-- Footer -->
    <footer id="main-footer" style="background-color: #212529 !important; color: white !important; padding: 3rem 0 !important; margin-top: 2rem !important; position: relative !important; z-index: 100 !important; width: 100% !important; clear: both !important; display: block !important; visibility: visible !important; opacity: 1 !important;">
        <div class="container">
            <div class="row">
                <!-- Company Info -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="assets/images/tomotrip-logo.png" alt="TomoTrip" style="height: 40px;" class="me-2">
                        <h5 class="mb-0">TomoTrip</h5>
                    </div>
                    <p class="text-muted small">Connecting travelers with trusted local guides for authentic and safe travel experiences across Japan.</p>
                    <div class="d-flex gap-3">
                        <a href="https://facebook.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Facebook">
                            <i class="bi bi-facebook fs-5"></i>
                        </a>
                        <a href="https://twitter.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Twitter">
                            <i class="bi bi-twitter fs-5"></i>
                        </a>
                        <a href="https://instagram.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Instagram">
                            <i class="bi bi-instagram fs-5"></i>
                        </a>
                        <a href="https://youtube.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="YouTube">
                            <i class="bi bi-youtube fs-5"></i>
                        </a>
                    </div>
                </div>

                <!-- Services -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">ã‚µãƒ¼ãƒ“ã‚¹</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#guides-section" class="text-muted text-decoration-none hover-link" onclick="scrollToGuides()">ã‚¬ã‚¤ãƒ‰ã‚’æ¢ã™</a></li>
                        <li class="mb-2"><a href="guide-registration-v2.html" class="text-muted text-decoration-none hover-link" target="_blank">ã‚¬ã‚¤ãƒ‰ã«ãªã‚‹</a></li>
                        <li class="mb-2"><a href="/tourist-registration-simple.html" class="text-muted text-decoration-none hover-link" target="_blank">è¦³å…‰å®¢ç™»éŒ²</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showManagementCenter()">äºˆç´„ç®¡ç†</a></li>
                        <li class="mb-2"><a href="sponsor-registration.html" class="text-muted text-decoration-none hover-link">ã‚¹ãƒãƒ³ã‚µãƒ¼ç™»éŒ²</a></li>
                        <li class="mb-2"><a href="admin-login.html" class="text-muted text-decoration-none hover-link">ğŸ” é‹å–¶è€…ãƒ­ã‚°ã‚¤ãƒ³</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">ã‚µãƒãƒ¼ãƒˆ</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showFAQ()">FAQ</a></li>
                        <li class="mb-2"><a href="chat.html" class="text-muted text-decoration-none hover-link">ãŠå•ã„åˆã‚ã›</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showSafety()">å®‰å…¨ãƒ»ä¿é™º</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCancellation()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showHelp()">Help Center</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">æ³•çš„äº‹é …</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showAbout()">ä¼šç¤¾æ¡ˆå†…</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showTerms()">åˆ©ç”¨è¦ç´„</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showPrivacy()">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCookies()">Cookie Policy</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCompliance()">æ³•çš„éµå®ˆ</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <h6 class="text-white mb-3">é€£çµ¡å…ˆ</h6>
                    <div class="mb-3">
                        <p class="text-muted small mb-2">
                            <i class="bi bi-envelope me-2"></i>
                            <a href="mailto:info@tomotrip.com" class="text-muted text-decoration-none hover-link">info@tomotrip.com</a>
                        </p>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-telephone me-2"></i>
                            <a href="tel:+81-3-1234-5678" class="text-muted text-decoration-none hover-link">+81-3-1234-5678</a>
                        </p>
                        <p class="text-muted small mb-3">
                            <i class="bi bi-clock me-2"></i>Mon-Fri 9:00-18:00 JST
                        </p>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-geo-alt me-2"></i>ã€’100-0001 Tokyo, Chiyoda, Chiyoda 1-1
                        </p>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted small mb-2">Emergency Support:</p>
                        <p class="text-warning small">
                            <i class="bi bi-telephone-fill me-2"></i>
                            <a href="tel:080-9999-8888" class="text-warning text-decoration-none hover-link">080-9999-8888</a>
                            <br><small class="text-muted">(24/7 Available)</small>
                        </p>
                    </div>
                </div>
            </div>

            <hr class="my-4 border-secondary">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="text-muted small mb-0">&copy; 2025 TomoTrip. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted small mb-0">Made with â¤ï¸ for travelers and local guides</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Tourist Login Modal -->
    <div class="modal fade" id="touristLoginModal" tabindex="-1" aria-labelledby="touristLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="touristLoginModalLabel">
                        <i class="bi bi-person-circle me-2"></i>è¦³å…‰å®¢ãƒ­ã‚°ã‚¤ãƒ³
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>è¦³å…‰å®¢å‘ã‘ã‚µãƒ¼ãƒ“ã‚¹</strong><br>
                            <small>ã‚¬ã‚¤ãƒ‰ã®è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ã«ã¯ã€ã¾ãšè¦³å…‰å®¢ã¨ã—ã¦ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚</small>
                        </div>
                    </div>
                    
                    <form id="touristLoginForm" onsubmit="handleTouristLogin(event)">
                        <div class="mb-3">
                            <label for="touristEmailLogin" class="form-label fw-bold">
                                <i class="bi bi-envelope me-1"></i>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                            </label>
                            <input type="email" class="form-control" id="touristEmailLogin" placeholder="your@email.com" required style="border-radius: 10px; padding: 12px;">
                            <small class="text-muted">ç™»éŒ²æ™‚ã«ä½¿ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</small>
                        </div>
                        
                        <div class="mb-4">
                            <label for="touristPhoneLogin" class="form-label fw-bold">
                                <i class="bi bi-telephone me-1"></i>é›»è©±ç•ªå·
                            </label>
                            <input type="tel" class="form-control" id="touristPhoneLogin" placeholder="080-1234-5678" required style="border-radius: 10px; padding: 12px;">
                            <small class="text-muted">ç™»éŒ²æ™‚ã«ä½¿ç”¨ã—ãŸé›»è©±ç•ªå·</small>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 12px; border-radius: 10px; font-weight: 600;">
                                <i class="bi bi-box-arrow-in-right me-2"></i>ãƒ­ã‚°ã‚¤ãƒ³
                            </button>
                            <div class="text-center mt-3">
                                <small class="text-muted">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„å ´åˆã¯</small><br>
                                <button type="button" class="btn btn-link" id="showTouristRegistration">
                                    <i class="bi bi-person-plus me-1"></i>æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide Login Modal -->
    <div class="modal fade" id="guideLoginModal" tabindex="-1" aria-labelledby="guideLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="guideLoginModalLabel">
                        <i class="bi bi-person-badge me-2"></i>ã‚¬ã‚¤ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="alert alert-success">
                            <i class="bi bi-shield-check me-2"></i>
                            <strong>ã‚¬ã‚¤ãƒ‰å°‚ç”¨</strong><br>
                            <small>ã‚¬ã‚¤ãƒ‰IDã¨é›»è©±ç•ªå·ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</small>
                        </div>
                    </div>
                    
                    <form id="guideLoginForm" onsubmit="handleGuideLogin(event)">
                        <div class="mb-3">
                            <label for="guideIdentifier" class="form-label fw-bold">
                                <i class="bi bi-person me-1"></i>ã‚¬ã‚¤ãƒ‰IDã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                            </label>
                            <input type="text" class="form-control" id="guideIdentifier" placeholder="ã‚¬ã‚¤ãƒ‰IDã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›" required style="border-radius: 10px; padding: 12px;">
                            <small class="text-muted">ç™»éŒ²æ™‚ã«ç™ºè¡Œã•ã‚ŒãŸã‚¬ã‚¤ãƒ‰IDã¾ãŸã¯ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</small>
                        </div>
                        
                        <div class="mb-4">
                            <label for="guidePhoneLogin" class="form-label fw-bold">
                                <i class="bi bi-telephone me-1"></i>é›»è©±ç•ªå·
                            </label>
                            <input type="tel" class="form-control" id="guidePhoneLogin" placeholder="080-1234-5678" required style="border-radius: 10px; padding: 12px;">
                            <small class="text-muted">ç™»éŒ²æ™‚ã«ä½¿ç”¨ã—ãŸé›»è©±ç•ªå·</small>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px; border-radius: 10px; font-weight: 600;">
                                <i class="bi bi-box-arrow-in-right me-2"></i>ãƒ­ã‚°ã‚¤ãƒ³
                            </button>
                            <div class="text-center mt-3">
                                <small class="text-muted">ã‚¬ã‚¤ãƒ‰ç™»éŒ²ãŒãŠæ¸ˆã¿ã§ãªã„å ´åˆã¯</small><br>
                                <a href="guide-registration-v2.html" class="btn btn-link" target="_blank">
                                    <i class="bi bi-person-badge me-1"></i>ã‚¬ã‚¤ãƒ‰ç™»éŒ²ã¯ã“ã¡ã‚‰
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Guide Registration Modal (DISABLED - use detailed form instead) -->
    <div class="modal fade" id="guideRegistrationModal" tabindex="-1" aria-labelledby="guideRegistrationModalLabel" aria-hidden="true" style="display: none !important;" data-disabled="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="guideRegistrationModalLabel">
                        <i class="bi bi-map me-2"></i>ã‚¬ã‚¤ãƒ‰ç™»éŒ²
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="guideRegistrationForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="guideName" class="form-label">ã‚¬ã‚¤ãƒ‰å <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="guideName" required style="border-radius: 10px;">
                            </div>
                            <div class="col-md-6">
                                <label for="guideEmail" class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="guideEmail" required style="border-radius: 10px;">
                            </div>
                            <div class="col-md-6">
                                <label for="guidePhoneReg" class="form-label">é›»è©±ç•ªå· <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="guidePhoneReg" required style="border-radius: 10px;">
                            </div>
                            <div class="col-md-6">
                                <label for="guideLocation" class="form-label">æ´»å‹•åœ°åŸŸ <span class="text-danger">*</span></label>
                                <select class="form-select" id="guideLocation" required style="border-radius: 10px;">
                                    <option value="">åœ°åŸŸã‚’é¸æŠ</option>
                                    <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                                    <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                                    <option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option>
                                    <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                                    <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                                    <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
                                    <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
                                    <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="guideLanguages" class="form-label">å¯¾å¿œè¨€èª <span class="text-danger">*</span></label>
                                <div class="form-check-container" style="max-height: 120px; overflow-y: auto; border: 1px solid #ced4da; border-radius: 10px; padding: 10px;">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="æ—¥æœ¬èª" id="lang-japanese">
                                        <label class="form-check-label" for="lang-japanese">æ—¥æœ¬èª</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="è‹±èª" id="lang-english">
                                        <label class="form-check-label" for="lang-english">è‹±èª</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="ä¸­å›½èª" id="lang-chinese">
                                        <label class="form-check-label" for="lang-chinese">ä¸­å›½èª</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="éŸ“å›½èª" id="lang-korean">
                                        <label class="form-check-label" for="lang-korean">éŸ“å›½èª</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="ã‚¹ãƒšã‚¤ãƒ³èª" id="lang-spanish">
                                        <label class="form-check-label" for="lang-spanish">ã‚¹ãƒšã‚¤ãƒ³èª</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="ãƒ•ãƒ©ãƒ³ã‚¹èª" id="lang-french">
                                        <label class="form-check-label" for="lang-french">ãƒ•ãƒ©ãƒ³ã‚¹èª</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="guidePrice" class="form-label">æ–™é‡‘ (å††/æ—¥) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="guidePrice" required min="1000" max="50000" style="border-radius: 10px;">
                            </div>
                            <div class="col-12">
                                <label for="guideDescription" class="form-label">è‡ªå·±ç´¹ä»‹ãƒ»çµŒé¨“ <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="guideDescription" rows="4" required style="border-radius: 10px;" placeholder="ã‚ãªãŸã®çµŒé¨“ã€å°‚é–€çŸ¥è­˜ã€ã‚¬ã‚¤ãƒ‰ã¨ã—ã¦ã®é­…åŠ›ã‚’æ•™ãˆã¦ãã ã•ã„..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="button" class="btn btn-success" id="guideRegistrationSubmitBtn" style="border-radius: 25px; padding: 10px 20px; background: linear-gradient(135deg, #28a745, #20c997); border: none;">
                        <i class="bi bi-check-circle me-2"></i>ã‚¬ã‚¤ãƒ‰ã¨ã—ã¦ç™»éŒ²
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- All JavaScript functionality handled by app-init.mjs ESM module system -->
    <!-- No inline scripts needed - CSP compliant architecture -->
    

</body>
</html>
<!-- test -->