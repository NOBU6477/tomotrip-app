# 回帰テスト（検索 × ページ × 再検索）

このドキュメントは、検索・ページネーション・詳細遷移に関する
過去の不具合（検索リセット、ページズレ、重複表示など）が
再発していないことを確認するための必須テスト手順である。

リリース前、仕様変更後、検索関連の修正後は必ず実施すること。

================================
■ シナリオA
検索 → ページ移動 → 詳細 → 戻る（検索状態復元）
================================

目的：
検索条件・ページ番号・スクロール位置が
「詳細→戻る」で正しく復元されることを確認する。

手順：
1. ガイド一覧ページを開く
2. 条件を設定する
   - 地域：例）東京都
   - 言語：例）英語
   - 価格・キーワード：任意
3. 検索を実行
4. 結果一覧が表示されることを確認
5. 次のページへ移動（2ページ目）
6. 任意のガイドで「詳細を見る」を押す
7. 詳細ページが表示されることを確認
8. 戻る（ボタンまたはブラウザ戻る）を押す

合格条件（PASS）：
- 検索条件が維持されている
- ページ番号が維持されている
- 表示結果が検索条件と一致している
- デフォルト状態に戻らない

================================
■ シナリオB
検索 → 30秒更新 → 状態維持
================================

目的：
30秒自動更新によって検索結果やページ状態が
壊れないことを確認する。

手順：
1. 条件を設定して検索
2. 次のページへ移動（2ページ目）
3. そのまま40秒待つ（自動更新を跨ぐ）
4. 表示状態を確認する

合格条件（PASS）：
- 検索条件が維持されている
- ページ番号が変わらない
- 重複表示や別条件の混入が起きない
- 操作不能にならない

================================
■ シナリオC
検索 → ページ移動 → 条件変更して再検索
================================

目的：
再検索時に古い検索結果やページ状態が
正しくリセットされることを確認する。

手順：
1. 条件①で検索（例：東京都 × 英語）
2. 次のページへ移動
3. 条件②に変更（例：東京都 × 日本語）
4. 検索を再実行
5. 表示結果を確認
6. 必要であれば次のページへ移動
7. 条件③に変更して再検索

合格条件（PASS）：
- 再検索後は必ず1ページ目から表示される
- 表示結果が新しい条件に完全一致する
- 古い条件の結果が混ざらない
- 件数表示とカード数が一致する

================================
■ スマホ簡易チェック（必須）
================================

- シナリオAの「詳細 → 戻る」をスマホで1回実施
- 戻ったときに検索状態が維持されていることを確認

================================
■ 実施タイミング
================================

- 本番リリース前
- 検索・ページネーション・詳細遷移の修正後
- ガイドデータ構造変更後

================================
■ デバッグモード
================================

TT-DEBUG モードを有効にして詳細ログを確認する場合：
1. ブラウザのコンソールで `window.__TT_DEBUG = true` を入力
2. ページをリロード
3. 操作を行い、コンソールログを確認

デバッグモードでは以下が出力される:
- `[TT-DEBUG] context=...` - ページネーション状態の詳細
- `✅` - 正常（重複なし、カウンター整合）
- `❌` - エラー（重複あり、カウンター不整合、フィルタ違反）

通常モードではデバッグログは出力されない（本番影響なし）。

================================
■ 補足
================================

- 本テストは「人が見て判断できる」ことを重視する。
- 検索系修正後は必ずこのドキュメントを確認すること。
